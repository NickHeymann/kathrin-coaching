<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com" rel="preconnect"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="default-src 'self'; script-src 'self' 'nonce-studio-2024' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; connect-src https://api.github.com https://raw.githubusercontent.com; img-src 'self' https: data: blob:; media-src 'self' https: blob:;" http-equiv="Content-Security-Policy"/>
<title>Gl√ºck √ºber Zweifel - Content Studio</title>
<style>
        :root {
            --primary: #2C4A47;
            --primary-light: #3d5f5b;
            --primary-dark: #1e3533;
            --accent: #D4A574;
            --accent-hover: #c49564;
            --bg: #f8f6f3;
            --bg-dark: #1a1a1a;
            --text: #333;
            --text-light: #666;
            --border: #ddd;
            --success: #4CAF50;
            --warning: #ff9800;
            --error: #f44336;
            --info: #2196F3;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow: hidden;
        }

        /* ============================================
           HEADER MIT MODE-TABS
           ============================================ */
        .studio-

        .studio-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .studio-logo {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }

        .studio-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .studio-subtitle {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        /* Mode Tabs */
        .mode-tabs {
            display: flex;
            gap: 0.25rem;
            background: rgba(0,0,0,0.2);
            padding: 0.25rem;
            border-radius: 10px;
        }

        .mode-tab {
            padding: 0.6rem 1.25rem;
            background: transparent;
            color: rgba(255,255,255,0.7);
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .mode-tab:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .mode-tab.active {
            background: white;
            color: var(--primary);
        }

        .mode-tab-icon {
            font-size: 1.1rem;
        }

        .studio-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-ghost {
            background: transparent;
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .btn-ghost:hover { background: rgba(255,255,255,0.1); }

        .btn-primary {
            background: var(--accent);
            color: white;
        }
        .btn-primary:hover { background: var(--accent-hover); }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .status-pill {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.8rem;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }
        .status-dot.warning { background: var(--warning); }
        .status-dot.error { background: var(--error); }

        /* ============================================
           MAIN CONTENT AREA
           ============================================ */
        .studio-main {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .mode-content {
            display: none;
            width: 100%;
            height: 100%;
        }

        .mode-content.active {
            display: flex;
        }

        /* ============================================
           MODE 1: WEBSITE EDITOR
           ============================================ */
        .website-editor {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .website-sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-

        .sidebar-header h3 {
            font-size: 0.9rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .page-select {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.85rem;
            background: white;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .sidebar-section {
            margin-bottom: 1.5rem;
        }

        .sidebar-section h4 {
            font-size: 0.8rem;
            color: var(--text-light);
            text-transform: uppercase;
            margin-bottom: 0.75rem;
        }

        .change-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .change-item {
            padding: 0.6rem;
            background: var(--bg);
            border-radius: 8px;
            font-size: 0.8rem;
            border-left: 3px solid var(--accent);
        }

        .change-item.image { border-left-color: var(--info); }
        .change-item.video { border-left-color: #9c27b0; }

        .website-frame-container {
            flex: 1;
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .website-frame {
            width: 100%;
            height: 100%;
            background: white;
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .website-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-light);
            text-align: center;
        }

        .website-placeholder-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* ============================================
           MODE 2: BLOG EDITOR
           ============================================ */
        .blog-editor {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .blog-sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .blog-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .blog-tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-light);
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .blog-tab:hover { background: var(--bg); }
        .blog-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .new-post-btn {
            margin: 0.75rem;
            padding: 0.75rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .new-post-btn:hover { background: var(--primary-light); }

        .post-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .post-item {
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 0.5rem;
            border: 1px solid transparent;
            transition: all 0.15s;
        }
        .post-item:hover { background: var(--bg); }
        .post-item.active {
            background: #e8f5e9;
            border-color: var(--success);
        }
        .post-item.draft { border-left: 3px solid var(--warning); }

        .post-item-title {
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .post-item-meta {
            font-size: 0.7rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .post-status-badge {
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .post-status-badge.draft { background: #fff3e0; color: #e65100; }
        .post-status-badge.scheduled { background: #e3f2fd; color: #1565c0; }
        .post-status-badge.published { background: #e8f5e9; color: #2e7d32; }

        /* Blog Editor Main */
        .blog-editor-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .blog-toolbar {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.75rem 1rem;
            background: #fafafa;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 0.2rem;
            padding-right: 0.6rem;
            margin-right: 0.6rem;
            border-right: 1px solid var(--border);
        }
        .toolbar-group:last-child { border-right: none; margin-right: 0; }

        .toolbar-btn {
            width: 34px;
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            color: var(--text);
            transition: all 0.1s;
        }
        .toolbar-btn:hover { background: #e0e0e0; }
        .toolbar-btn.active { background: var(--primary); color: white; }

        .toolbar-select {
            padding: 0.35rem 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.8rem;
            background: white;
        }

        .blog-content-area {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
        }

        .blog-content-inner {
            max-width: 800px;
            margin: 0 auto;
        }

        .blog-title-input {
            width: 100%;
            font-size: 2.2rem;
            font-weight: 700;
            border: none;
            outline: none;
            color: var(--primary);
            margin-bottom: 0.75rem;
            font-family: Georgia, serif;
        }
        .blog-title-input::placeholder { color: #ccc; }

        .blog-excerpt-input {
            width: 100%;
            font-size: 1rem;
            border: none;
            outline: none;
            color: var(--text-light);
            margin-bottom: 1.5rem;
            padding: 0.75rem;
            background: var(--bg);
            border-radius: 8px;
            resize: none;
        }

        .blog-content-editor {
            min-height: 400px;
            border: none;
            outline: none;
            font-size: 1.05rem;
            line-height: 1.8;
            color: var(--text);
        }
        .blog-content-editor:focus { outline: none; }
        .blog-content-editor p { margin-bottom: 1rem; }
        .blog-content-editor h2 { font-size: 1.6rem; margin: 1.5rem 0 0.75rem; color: var(--primary); }
        .blog-content-editor h3 { font-size: 1.3rem; margin: 1.25rem 0 0.5rem; color: var(--primary); }
        .blog-content-editor blockquote {
            border-left: 4px solid var(--accent);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: var(--text-light);
        }
        .blog-content-editor img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        /* Blog Settings Panel */
        .blog-settings {
            width: 300px;
            background: #fafafa;
            border-left: 1px solid var(--border);
            overflow-y: auto;
            flex-shrink: 0;
        }

        .settings-section {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .settings-section h4 {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.6rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .settings-row {
            margin-bottom: 0.75rem;
        }

        .settings-label {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
            display: block;
        }

        .settings-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.85rem;
        }
        .settings-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .settings-textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.8rem;
            resize: vertical;
            min-height: 70px;
        }

        .featured-image-upload {
            width: 100%;
            aspect-ratio: 16/9;
            background: white;
            border: 2px dashed var(--border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
        }
        .featured-image-upload:hover { border-color: var(--primary); }
        .featured-image-upload.has-image { border-style: solid; }
        .featured-image-upload img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .category-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .category-tag {
            padding: 0.3rem 0.6rem;
            background: white;
            border: 1px solid var(--border);
            border-radius: 15px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.15s;
        }
        .category-tag:hover { border-color: var(--primary); }
        .category-tag.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ============================================
           MODE 3: PUBLISHING QUEUE
           ============================================ */
        .publishing-queue {
            display: flex;
            width: 100%;
            height: 100%;
            background: var(--bg);
        }

        .queue-main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .queue-

        .queue-header h2 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .queue-header p {
            color: var(--text-light);
        }

        .queue-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .queue-section h3 {
            font-size: 1rem;
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .queue-section h3 .count {
            background: var(--bg);
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.75rem;
        }

        .queue-items {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .queue-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--bg);
            border-radius: 8px;
            border-left: 4px solid var(--info);
        }
        .queue-item.scheduled { border-left-color: var(--warning); }
        .queue-item.published { border-left-color: var(--success); }
        .queue-item.error { border-left-color: var(--error); }

        .queue-item-content {
            flex: 1;
        }

        .queue-item-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .queue-item-meta {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .queue-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .queue-item-actions button {
            padding: 0.4rem 0.75rem;
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .queue-empty {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
        }

        .queue-empty-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            opacity: 0.5;
        }

        /* ============================================
           SETUP SCREEN
           ============================================ */
        .setup-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--bg) 0%, #ece8e1 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20000;
        }
        .setup-screen.hidden { display: none; }

        .setup-card {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            text-align: center;
        }

        .setup-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2.5rem;
        }

        .setup-card h1 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 1.75rem;
        }

        .setup-card p {
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .setup-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        .setup-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .setup-btn {
            width: 100%;
            padding: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .setup-btn:hover { background: var(--primary-light); }

        .setup-help {
            margin-top: 1.5rem;
            text-align: left;
        }

        .setup-help summary {
            cursor: pointer;
            color: var(--accent);
            font-weight: 500;
        }

        .setup-help-content {
            margin-top: 1rem;
            font-size: 0.85rem;
            color: var(--text-light);
            line-height: 1.7;
        }

        .setup-help-content ol {
            margin: 0.5rem 0 0 1.5rem;
        }

        .setup-help-content code {
            background: var(--bg);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
        }

        /* ============================================
           TOAST
           ============================================ */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 30000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            padding: 0.75rem 1.25rem;
            background: var(--text);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideIn 0.3s;
        }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--error); }
        .toast.warning { background: var(--warning); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ============================================
           EDITOR STATS BAR
           ============================================ */
        .editor-stats {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 0.5rem 1.25rem;
            border-radius: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            font-size: 0.8rem;
            color: var(--text-light);
            display: none;
            gap: 1.25rem;
            z-index: 100;
        }

        .editor-stats.visible { display: flex; }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        /* ============================================
           IMAGE MODAL
           ============================================ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 25000;
        }
        .modal-overlay.open { display: flex; }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow: hidden;
        }

        .modal-

        .modal-header h3 {
            font-size: 1rem;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: calc(85vh - 60px);
        }

        .image-drop-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 2.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .image-drop-zone:hover, .image-drop-zone.dragover {
            border-color: var(--primary);
            background: var(--bg);
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
            max-height: 250px;
            overflow-y: auto;
        }

        .gallery-item {
            aspect-ratio: 1;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.15s;
        }
        .gallery-item:hover { border-color: var(--primary); }
        .gallery-item.selected { border-color: var(--success); }

        /* ============================================
           PREVIEW MODAL
           ============================================ */
        .preview-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            z-index: 26000;
        }
        .preview-modal.open { display: flex; flex-direction: column; }

        .preview-

        .preview-devices {
            display: flex;
            gap: 0.5rem;
        }

        .preview-device-btn {
            padding: 0.4rem 0.8rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .preview-device-btn.active {
            background: white;
            color: var(--primary);
        }

        .preview-body {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            overflow: auto;
        }

        .preview-frame {
            background: white;
            border-radius: 8px;
            overflow: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            transition: width 0.3s;
            max-height: 100%;
        }
        .preview-frame.desktop { width: 100%; max-width: 1200px; }
        .preview-frame.tablet { width: 768px; }
        .preview-frame.mobile { width: 375px; }

        /* ============================================
           LOADING OVERLAY
           ============================================ */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 27000;
            flex-direction: column;
        }
        .loading-overlay.visible { display: flex; }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 1rem;
            color: var(--text-light);
        }
    </style>

<link rel="stylesheet" href="css/components/header.css">
</head>
<body>
<!-- Setup Screen -->
<div class="setup-screen" id="setupScreen">
<div class="setup-card">
<div class="setup-logo">‚ú®</div>
<h1>Content Studio</h1>
<p>Dein Arbeitsplatz f√ºr Website-Bearbeitung, Blog-Schreiben und Ver√∂ffentlichung.</p>
<input class="setup-input" id="tokenInput" placeholder="GitHub Token eingeben..." type="password"/>
<button class="setup-btn" id="setupBtn" onclick="setupToken()">Studio starten</button>
<details class="setup-help">
<summary>Wie bekomme ich einen Token?</summary>
<div class="setup-help-content">
<ol>
<li>Gehe zu <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a></li>
<li>Klicke auf "Generate new token" ‚Üí "Classic"</li>
<li>Gib einen Namen ein (z.B. "Content Studio")</li>
<li>W√§hle eine lange Laufzeit (z.B. 1 Jahr)</li>
<li>Aktiviere <code>repo</code> (Repository-Zugriff)</li>
<li>Klicke "Generate token" und kopiere ihn hierher</li>
</ol>
<p><strong>Hinweis:</strong> Der Token wird nur in deinem Browser gespeichert.</p>
</div>
</details>
</div>
</div>
<!-- Main Header -->
<!-- Header -->
<header>
<div class="container header-inner">
<a class="logo" href="index.html">KATHRIN STAHL</a>
<nav id="mainNav">
<div class="nav-dropdown" onclick="toggleDropdown(this, event)">
<span class="nav-link">Angebote</span>
<div aria-label="Angebote" class="dropdown-menu" role="menu">
<a href="index.html#angebote" role="menuitem">

<span class="dropdown-text">
<strong>1:1 Coaching</strong>
<span>Einzelbegleitung online &amp; vor Ort</span>
</span>
</a>
<a href="index.html#angebote" role="menuitem">

<span class="dropdown-text">
<strong>Paar-Coaching</strong>
<span>Beziehungskrisen gemeinsam meistern</span>
</span>
</a>
<a href="paar-retreat.html" role="menuitem">

<span class="dropdown-text">
<strong>Paar-Retreat Portugal</strong>
<span>5 Tage f√ºr eure Beziehung</span>
</span>
</a>
<a href="retreats-in-portugal.html" role="menuitem">

<span class="dropdown-text">
<strong>Retreats in Portugal</strong>
<span>Auszeit im Alentejo</span>
</span>
</a>
<a href="pferdegestuetztes-coaching.html" role="menuitem">

<span class="dropdown-text">
<strong>Pferdegest√ºtztes Coaching</strong>
<span>Meine Methode erkl√§rt</span>
</span>
</a>
<a href="casinha.html" role="menuitem">

<span class="dropdown-text">
<strong>Die Casinha</strong>
<span>Deine Unterkunft im Alentejo</span>
</span>
</a>
</div>
</div>
<div class="nav-dropdown" onclick="toggleDropdown(this, event)">
<span class="nav-link">Selbsttests</span>
<div aria-label="Selbsttests" class="dropdown-menu" role="menu">
<a href="quiz-hochsensibel.html" role="menuitem">

<span class="dropdown-text">
<strong>Hochsensibel?</strong>
<span>HSPS-Test nach Elaine Aron</span>
</span>
</a>
<a href="quiz-hochbegabt.html" role="menuitem">

<span class="dropdown-text">
<strong>Intensit√§ts-Profil</strong>
<span>Overexcitabilities nach Dabrowski</span>
</span>
</a>
<a href="quiz-beziehung.html" role="menuitem">

<span class="dropdown-text">
<strong>Beziehungs-Check</strong>
<span>Four Horsemen nach Gottman</span>
</span>
</a>
<a href="quiz-lebenskrise.html" role="menuitem">

<span class="dropdown-text">
<strong>Burnout-Test</strong>
<span>Copenhagen Burnout Inventory</span>
</span>
</a>
<a href="quiz-midlife.html" role="menuitem">

<span class="dropdown-text">
<strong>Midlife Crisis</strong>
<span>CMCM-Fragebogen</span>
</span>
</a>
<a href="quiz-paar-kompass.html" role="menuitem">

<span class="dropdown-text">
<strong>Paar-Kompass</strong>
<span>Wo steht eure Beziehung?</span>
</span>
</a>
</div>
</div>
<a href="blog.html">Blog</a>
<a href="media.html">Videos</a>
<a href="kathrin.html">√úber mich</a>
<div class="contact-dropdown">
<a class="contact-dropdown-trigger" href="index.html#kontakt" onclick="toggleContactDropdown(this, event)">Kontakt</a>
<div class="contact-dropdown-menu">
<a class="contact-item" href="https://wa.me/4915140436795" target="_blank">
<span class="contact-icon">üí¨</span>
<span>WhatsApp</span>
</a>
<a class="contact-item" href="mailto:kathrin@kathrinstahl.com">
<span class="contact-icon">‚úâÔ∏è</span>
<span>E-Mail</span>
</a>
<a class="contact-item" href="https://cal.com/kathrinstahl" target="_blank">
<span class="contact-icon">üìÖ</span>
<span>Erstgespr√§ch buchen</span>
</a>
</div>
</div>
<a class="nav-cta" href="https://cal.com/kathrinstahl" target="_blank">Gespr√§ch buchen</a>
</nav>
<button aria-label="Menu √∂ffnen" class="menu-toggle" onclick="toggleMobileNav()">
<span></span>
<span></span>
<span></span>
</button>
</div>
</header>
<!-- Main Content -->
<main class="studio-main">
<!-- Mode 1: Website Editor -->
<div class="mode-content active" id="modeWebsite">
<div class="website-editor">
<aside class="website-sidebar">
<div>
<h3>Seite ausw√§hlen</h3>
<select id="pageSelect" onchange="loadPage(this.value)">
<option>Seite w√§hlen...</option>
<optgroup label="Hauptseiten">
<option value="index.html">Startseite</option>
<option value="kathrin.html">√úber Kathrin</option>
<option value="fuer-wen.html">F√ºr Wen</option>
<option value="ansaetze-ganzheitliche-begleitung-fuer-einzelne-paare.html">Meine Ans√§tze</option>
<option value="contact.html">Kontakt</option>
</optgroup>
<optgroup label="Coaching">
<option value="einzelbegleitung-sinnkrise-lebensumbruch.html">Einzelbegleitung</option>
<option value="paarbegleitung-beziehungskrise-neuanfang-kathrin-stahl.html">Paarbegleitung</option>
<option value="investition.html">Investition</option>
</optgroup>
<optgroup label="Retreats Portugal">
<option value="retreats-in-portugal.html">Retreats √úbersicht</option>
<option value="paar-retreat-in-portugal-beziehung-krise-kathrin-stahl.html">Paar-Retreat</option>
<option value="einzelretreat-portugal-alentejo-kathrin-stahl.html">Einzel-Retreat</option>
<option value="retreat-aufstellung-mit-pferden.html">Aufstellung mit Pferden</option>
<option value="herzenswunsch-folge-deiner-sehnsucht.html">Herzenswunsch Retreat</option>
<option value="wunder-retreat.html">Wunder Retreat</option>
</optgroup>
<optgroup label="Medien">
<option value="blog.html">Blog √úbersicht</option>
<option value="glueck-ueber-zweifel-videos-mit-kathrin-stahl.html">YouTube Videos</option>
<option value="glueck-ueber-zweifel-dein-podcast.html">Podcast</option>
</optgroup>
<optgroup label="Rechtliches">
<option value="impressum.html">Impressum</option>
<option value="datenschutzerklaerung.html">Datenschutz</option>
</optgroup>
</select>
</div>
<div>
<div>
<h4>√Ñnderungen</h4>
<div class="change-list" id="changesList">
<p>Noch keine √Ñnderungen</p>
</div>
</div>
<div>
<h4>Tipps</h4>
<p>
                                ‚Ä¢ Klicke auf Texte um sie zu bearbeiten<br/>
                                ‚Ä¢ Klicke auf Bilder um sie zu ersetzen<br/>
                                ‚Ä¢ Cmd+S zum Speichern<br/>
                                ‚Ä¢ Cmd+Z zum R√ºckg√§ngig
                            </p>
</div>
</div>
</aside>
<div class="website-frame-container">
<div class="website-placeholder" id="websitePlaceholder">
<div class="website-placeholder-icon">üåê</div>
<h3>W√§hle eine Seite aus</h3>
<p>Klicke links im Dropdown um eine Seite zu bearbeiten</p>
</div>
<iframe class="website-frame" id="websiteFrame"></iframe>
</div>
</div>
</div>
<!-- Mode 2: Blog Editor -->
<div class="mode-content" id="modeBlog">
<div class="blog-editor">
<aside class="blog-sidebar">
<div class="blog-tabs">
<button class="blog-tab active" onclick="showBlogTab('drafts')">Entw√ºrfe</button>
<button class="blog-tab" onclick="showBlogTab('published')">Ver√∂ffentlicht</button>
</div>
<button class="new-post-btn" onclick="createNewPost()">
<span>+</span> Neuer Beitrag
                    </button>

</aside>
<div class="blog-editor-main">
<div class="blog-toolbar">
<div class="toolbar-group">
<select class="toolbar-select" id="blockType" onchange="formatBlock(this.value)">
<option value="p">Absatz</option>
<option value="h2">√úberschrift 2</option>
<option value="h3">√úberschrift 3</option>
<option value="blockquote">Zitat</option>
</select>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="execCmd('bold')" title="Fett"><strong>B</strong></button>
<button class="toolbar-btn" onclick="execCmd('italic')" title="Kursiv"><em>I</em></button>
<button class="toolbar-btn" onclick="execCmd('underline')" title="Unterstrichen"><u>U</u></button>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="execCmd('insertUnorderedList')" title="Aufz√§hlung">‚Ä¢</button>
<button class="toolbar-btn" onclick="execCmd('insertOrderedList')" title="Nummerierung">1.</button>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="insertLink()" title="Link">üîó</button>
<button class="toolbar-btn" onclick="openImageModal()" title="Bild">üì∑</button>
<button class="toolbar-btn" onclick="insertVideo()" title="Video">üé¨</button>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="execCmd('undo')" title="R√ºckg√§ngig">‚Ü∂</button>
<button class="toolbar-btn" onclick="execCmd('redo')" title="Wiederholen">‚Ü∑</button>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="openPreview()" title="Vorschau">üëÅ</button>
</div>
</div>
<div class="blog-content-area">
<div class="blog-content-inner">
<input class="blog-title-input" id="postTitle" oninput="onBlogChange()" placeholder="Titel eingeben..." type="text"/>
<textarea class="blog-excerpt-input" id="postExcerpt" oninput="onBlogChange()" placeholder="Kurzbeschreibung f√ºr SEO..." rows="2"></textarea>
<div class="blog-content-editor" contenteditable="true" id="postContent" oninput="onBlogChange()">
<p>Beginne hier mit deinem Beitrag...</p>
</div>
</div>
</div>
</div>
<aside class="blog-settings">
<div class="settings-section">
<h4>üì∑ Beitragsbild</h4>
<div class="featured-image-upload" id="featuredImageUpload" onclick="uploadFeaturedImage()">
<div>
<div>üì∑</div>
                                Bild hochladen
                            </div>
</div>
<div class="settings-row">
<label class="settings-label">Alt-Text (SEO)</label>
<input class="settings-input" id="featuredImageAlt" placeholder="Bildbeschreibung..." type="text"/>
</div>
</div>
<div class="settings-section">
<h4>üìÅ Kategorien</h4>
<div id="categoryTags">
<span data-cat="achtsamkeit">Achtsamkeit</span>
<span data-cat="selbstliebe">Selbstliebe</span>
<span data-cat="beziehung">Beziehung</span>
<span data-cat="pferdecoaching">Pferdecoaching</span>
<span data-cat="heldinnenreise">Heldinnenreise</span>
</div>
</div>
<div class="settings-section">
<h4>üîç SEO</h4>
<div class="settings-row">
<label class="settings-label">Meta-Titel <span id="metaTitleCount">0</span>/60</label>
<input class="settings-input" id="metaTitle" oninput="updateMetaCount()" placeholder="SEO Titel..." type="text"/>
</div>
<div class="settings-row">
<label class="settings-label">Meta-Beschreibung <span id="metaDescCount">0</span>/160</label>
<textarea class="settings-textarea" id="metaDescription" oninput="updateMetaCount()" placeholder="SEO Beschreibung..."></textarea>
</div>
<div class="settings-row">
<label class="settings-label">URL-Slug</label>
<input class="settings-input" id="urlSlug" placeholder="url-name" type="text"/>
</div>
</div>
<div class="settings-section">
<h4>üìÖ Ver√∂ffentlichung</h4>
<div class="settings-row">
<label class="settings-label">Datum &amp; Uhrzeit</label>

</div>
<button class="btn btn-primary" onclick="schedulePost()">
                            Planen
                        </button>
</div>
</aside>
</div>
</div>
<!-- Mode 3: Publishing Queue -->
<div class="mode-content" id="modeQueue">
<div class="publishing-queue">
<div class="queue-main">
<div class="queue-header">
<h2>Ver√∂ffentlichungs-Warteschlange</h2>
<p>Hier siehst du alle geplanten und k√ºrzlich ver√∂ffentlichten Beitr√§ge.</p>
</div>
<div class="queue-section">
<h3>‚è∞ Geplant <span class="count" id="scheduledCount">0</span></h3>
<div class="queue-items" id="scheduledQueue">
<div class="queue-empty">
<div class="queue-empty-icon">üìÖ</div>
<p>Keine geplanten Beitr√§ge</p>
</div>
</div>
</div>
<div class="queue-section">
<h3>‚úÖ K√ºrzlich ver√∂ffentlicht <span class="count" id="publishedCount">0</span></h3>
<div class="queue-items" id="publishedQueue">
<div class="queue-empty">
<div class="queue-empty-icon">üìù</div>
<p>Noch keine ver√∂ffentlichten Beitr√§ge</p>
</div>
</div>
</div>
</div>
</div>
</div>
</main>
<!-- Editor Stats -->
<div class="editor-stats" id="editorStats">
<div class="stat-item">üìù <span id="wordCount">0</span> W√∂rter</div>
<div class="stat-item">‚è± <span id="readingTime">0</span> Min. Lesezeit</div>
<div class="stat-item">üìÑ <span id="charCount">0</span> Zeichen</div>
</div>
<!-- Image Modal -->
<div class="modal-overlay" id="imageModal">
<div class="modal-content">
<div class="modal-header">
<h3>Bild einf√ºgen</h3>
<button class="modal-close" onclick="closeImageModal()">√ó</button>
</div>
<div class="modal-body">
<div class="image-drop-zone" id="imageDropZone">
<div>üì∑</div>
<div>Bild hierher ziehen oder klicken</div>
<input accept="image/*" id="imageFileInput" type="file"/>
</div>
<h4>Oder aus Mediathek:</h4>

<div>
<label class="settings-label">Alt-Text</label>
<input class="settings-input" id="imageAltText" placeholder="Bildbeschreibung..." type="text"/>
</div>
<button class="btn btn-primary" onclick="insertSelectedImage()">
                    Bild einf√ºgen
                </button>
</div>
</div>
</div>
<!-- Preview Modal -->
<div class="preview-modal" id="previewModal">
<div class="preview-header">
<h3>Vorschau</h3>
<div class="preview-devices">
<button class="preview-device-btn active" onclick="setPreviewDevice('desktop')">Desktop</button>
<button class="preview-device-btn" onclick="setPreviewDevice('tablet')">Tablet</button>
<button class="preview-device-btn" onclick="setPreviewDevice('mobile')">Mobil</button>
</div>
<button class="btn btn-ghost" onclick="closePreview()">Schlie√üen</button>
</div>

</div>
<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">

<div class="loading-text" id="loadingText">L√§dt...</div>
</div>
<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>
<!-- DOMPurify f√ºr sichere HTML-Sanitization -->
<script crossorigin="anonymous" integrity="sha384-3XJAN3rswrHdGqLHC3V5s0ERRmJrqtOvC/1qVz8gg4RZMlWBNB9VCRa9Z6H/TqRt" nonce="studio-2024" src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
<script nonce="studio-2024">
        // ============================================
        // SECURITY UTILITIES
        // ============================================
        function escapeHtml(unsafe) {
            if (unsafe == null) return '';
            return String(unsafe)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function sanitizeHTML(dirty) {
            if (typeof DOMPurify !== 'undefined') {
                return DOMPurify.sanitize(dirty, {
                    ALLOWED_TAGS: ['p', 'br', 'b', 'i', 'u', 'strong', 'em', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
                                   'ul', 'ol', 'li', 'a', 'img', 'blockquote', 'pre', 'code', 'div', 'span',
                                   'table', 'thead', 'tbody', 'tr', 'th', 'td', 'hr', 'figure', 'figcaption'],
                    ALLOWED_ATTR: ['href', 'src', 'alt', 'title', 'class', 'id', 'style', 'target', 'rel',
                                   'width', 'height', 'loading'],
                    FORBID_TAGS: ['script', 'iframe', 'object', 'embed', 'form'],
                    FORBID_ATTR: ['onerror', 'onload', 'onclick', 'onmouseover']
                });
            }
            return escapeHtml(dirty);
        }

        // Sichere UTF-8 Base64 Encoding (ersetzt deprecated unescape)
        function utf8ToBase64(str) {
            return btoa(new TextEncoder().encode(str).reduce((data, byte) => data + String.fromCharCode(byte), ''));
        }

        function base64ToUtf8(base64) {
            const binary = atob(base64);
            const bytes = new Uint8Array(binary.length);
            for (let i = 0; i < binary.length; i++) {
                bytes[i] = binary.charCodeAt(i);
            }
            return new TextDecoder().decode(bytes);
        }

        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            owner: 'nickheymann',
            repo: 'kathrin-coaching',
            branch: 'main',
            autosaveInterval: 30000
        };

        // ============================================
        // STATE
        // ============================================
        let state = {
            token: null,
            currentMode: 'website',
            // Website Editor State
            currentPage: null,
            websiteChanges: [],
            hasWebsiteChanges: false,
            pageCache: {}, // Cache f√ºr geladene Seiten
            // Blog Editor State
            currentPost: null,
            drafts: [],
            publishedPosts: [],
            queue: [],
            selectedCategories: [],
            featuredImage: null,
            selectedImage: null,
            hasBlogChanges: false,
            currentBlogTab: 'drafts',
            imageCache: null, // Cache f√ºr Bilder
            imageCacheTime: 0
        };

        // ============================================
        // GITHUB API
        // ============================================
        const github = {
            async request(endpoint, options = {}) {
                const response = await fetch(`https://api.github.com${endpoint}`, {
                    ...options,
                    headers: {
                        'Authorization': `token ${state.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                if (!response.ok) throw new Error(`GitHub API error: ${response.status}`);
                return response.json();
            },

            async getFile(path) {
                try {
                    const data = await this.request(`/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${path}?ref=${CONFIG.branch}`);
                    return { content: atob(data.content), sha: data.sha };
                } catch (e) { return null; }
            },

            async saveFile(path, content, message) {
                const existing = await this.getFile(path);
                const body = {
                    message: message,
                    content: utf8ToBase64(content),
                    branch: CONFIG.branch
                };
                if (existing) body.sha = existing.sha;
                return this.request(`/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${path}`, { method: 'PUT', body: JSON.stringify(body) });
            },

            async uploadImage(filename, base64Data) {
                const content = base64Data.split(',')[1];
                return this.request(`/repos/${CONFIG.owner}/${CONFIG.repo}/contents/wp-content/uploads/blog/${filename}`, {
                    method: 'PUT',
                    body: JSON.stringify({ message: `Bild: ${filename}`, content: content, branch: CONFIG.branch })
                });
            },

            async listImages() {
                // Return cached images if available and fresh (5 min cache)
                const now = Date.now();
                if (state.imageCache && (now - state.imageCacheTime) < 300000) {
                    return state.imageCache;
                }

                try {
                    // Nur blog-Ordner laden (schneller)
                    const data = await this.request(`/repos/${CONFIG.owner}/${CONFIG.repo}/contents/wp-content/uploads/blog?ref=${CONFIG.branch}`);
                    const images = data
                        .filter(file => file.name.match(/\.(jpg|jpeg|png|gif|webp)$/i))
                        .slice(0, 24);

                    state.imageCache = images;
                    state.imageCacheTime = now;
                    return images;
                } catch (e) {
                    // Fallback: Versuche 2024 Ordner
                    try {
                        const data = await this.request(`/repos/${CONFIG.owner}/${CONFIG.repo}/contents/wp-content/uploads/2024?ref=${CONFIG.branch}`);
                        const images = data
                            .filter(file => file.name.match(/\.(jpg|jpeg|png|gif|webp)$/i))
                            .slice(0, 24);
                        state.imageCache = images;
                        state.imageCacheTime = now;
                        return images;
                    } catch (e2) { return []; }
                }
            }
        };

        // ============================================
        // SETUP (Token in sessionStorage f√ºr Sicherheit)
        // ============================================
        function checkSetup() {
            // Zuerst sessionStorage pr√ºfen
            let savedToken = sessionStorage.getItem('github_token');

            // Migration von localStorage (einmalig)
            if (!savedToken) {
                const oldToken = localStorage.getItem('github_token');
                if (oldToken) {
                    sessionStorage.setItem('github_token', oldToken);
                    localStorage.removeItem('github_token');
                    savedToken = oldToken;
                    console.log('Token von localStorage zu sessionStorage migriert');
                }
            }

            if (savedToken) {
                state.token = savedToken;
                document.getElementById('setupScreen').classList.add('hidden');
                initStudio();
            }
        }

        async function setupToken() {
            const token = document.getElementById('tokenInput').value.trim();
            if (!token) { toast('Bitte Token eingeben', 'error'); return; }

            const btn = document.getElementById('setupBtn');
            btn.disabled = true;
            btn.textContent = 'Pr√ºfe...';

            try {
                state.token = token;
                await github.request(`/repos/${CONFIG.owner}/${CONFIG.repo}`);
                // Token in sessionStorage speichern (sicherer)
                sessionStorage.setItem('github_token', token);
                localStorage.removeItem('github_token'); // Alte Tokens entfernen
                document.getElementById('setupScreen').classList.add('hidden');
                toast('Erfolgreich eingerichtet!', 'success');
                initStudio();
            } catch (e) {
                toast('Token ung√ºltig', 'error');
                state.token = null;
            }

            btn.disabled = false;
            btn.textContent = 'Studio starten';
        }

        function initStudio() {
            loadDrafts();
            loadQueue();
            setupCategoryTags();
            setupEventListeners();
            startAutosave();
            // Preload wichtige Seiten im Hintergrund (nach 1 Sekunde)
            setTimeout(preloadPages, 1000);
        }

        // ============================================
        // MODE SWITCHING
        // ============================================
        function switchMode(mode) {
            state.currentMode = mode;

            // Update tabs
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.mode === mode);
            });

            // Update content
            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.remove('active');
            });

            const modeId = mode === 'website' ? 'modeWebsite' : mode === 'blog' ? 'modeBlog' : 'modeQueue';
            document.getElementById(modeId).classList.add('active');

            // Update main action button
            const actionBtn = document.getElementById('mainActionBtn');
            if (mode === 'website') {
                actionBtn.textContent = 'Speichern';
                actionBtn.onclick = saveWebsiteChanges;
            } else if (mode === 'blog') {
                actionBtn.textContent = 'Ver√∂ffentlichen';
                actionBtn.onclick = publishPost;
            } else {
                actionBtn.style.display = 'none';
            }

            // Show/hide stats
            document.getElementById('editorStats').classList.toggle('visible', mode === 'blog');

            // Render queue when switching to it
            if (mode === 'queue') renderQueue();
        }

        // ============================================
        // WEBSITE EDITOR
        // ============================================
        async function loadPage(filename) {
            if (!filename) return;

            state.currentPage = filename;
            const frame = document.getElementById('websiteFrame');
            const placeholder = document.getElementById('websitePlaceholder');

            // Check cache first
            if (state.pageCache[filename]) {
                frame.style.display = 'block';
                placeholder.style.display = 'none';
                frame.srcdoc = state.pageCache[filename];
                frame.onload = () => setupFrameEditing(frame);
                return;
            }

            showLoading('Lade Seite...');

            try {
                const rawUrl = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${filename}`;
                const response = await fetch(rawUrl);
                const html = await response.text();

                // Cache the page
                state.pageCache[filename] = html;

                frame.style.display = 'block';
                placeholder.style.display = 'none';

                frame.srcdoc = html;
                frame.onload = () => {
                    setupFrameEditing(frame);
                    hideLoading();
                };
            } catch (e) {
                toast('Fehler beim Laden', 'error');
                hideLoading();
            }
        }

        // Preload wichtige Seiten im Hintergrund
        async function preloadPages() {
            const priorityPages = ['index.html', 'kathrin.html', 'contact.html'];
            for (const page of priorityPages) {
                if (!state.pageCache[page]) {
                    try {
                        const rawUrl = `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${CONFIG.branch}/${page}`;
                        const response = await fetch(rawUrl);
                        state.pageCache[page] = await response.text();
                    } catch (e) {}
                }
            }
        }

        function setupFrameEditing(frame) {
            const doc = frame.contentDocument;
            if (!doc) return;

            // Make texts editable
            const textElements = doc.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, a, li, td, th, label, button');
            textElements.forEach((el, idx) => {
                if (el.innerText.trim().length > 0 && el.children.length === 0) {
                    el.style.cursor = 'pointer';
                    el.dataset.editIdx = idx;

                    el.addEventListener('mouseenter', () => {
                        el.style.outline = '2px dashed #D4A574';
                    });

                    el.addEventListener('mouseleave', () => {
                        if (!el.isContentEditable) el.style.outline = '';
                    });

                    el.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        el.contentEditable = true;
                        el.style.outline = '2px solid #4CAF50';
                        el.style.background = 'rgba(76, 175, 80, 0.1)';
                        el.focus();
                    });

                    el.addEventListener('blur', () => {
                        el.contentEditable = false;
                        el.style.outline = '';
                        el.style.background = '';
                        trackWebsiteChange('text', el.dataset.editIdx, el.innerText);
                    });
                }
            });

            // Make images clickable
            const images = doc.querySelectorAll('img');
            images.forEach((img, idx) => {
                img.style.cursor = 'pointer';
                img.dataset.editIdx = idx;

                img.addEventListener('mouseenter', () => {
                    img.style.outline = '3px solid #2196F3';
                });

                img.addEventListener('mouseleave', () => {
                    img.style.outline = '';
                });

                img.addEventListener('click', (e) => {
                    e.preventDefault();
                    replaceImage(img);
                });
            });
        }

        function trackWebsiteChange(type, idx, value) {
            state.websiteChanges.push({ type, idx, value, timestamp: Date.now() });
            state.hasWebsiteChanges = true;
            updateStatus('unsaved');
            renderChangesList();
        }

        function renderChangesList() {
            const container = document.getElementById('changesList');
            if (state.websiteChanges.length === 0) {
                container.innerHTML = '<p style="color: var(--text-light); font-size: 0.8rem;">Noch keine √Ñnderungen</p>';
                return;
            }

            container.innerHTML = state.websiteChanges.slice(-5).map(change => `
                <div class="change-item ${change.type}">
                    <strong>${change.type === 'text' ? 'Text' : 'Bild'}</strong>
                    <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 0.25rem;">
                        ${change.value.substring(0, 50)}${change.value.length > 50 ? '...' : ''}
                    </div>
                </div>
            `).join('');
        }

        function replaceImage(img) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';

            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    img.src = e.target.result;
                    trackWebsiteChange('image', img.dataset.editIdx, 'Bild ersetzt');
                    toast('Bild ersetzt', 'success');
                };
                reader.readAsDataURL(file);
            };

            input.click();
        }

        async function saveWebsiteChanges() {
            if (!state.hasWebsiteChanges) {
                toast('Keine √Ñnderungen zu speichern', 'info');
                return;
            }

            showLoading('Speichere...');

            try {
                const frame = document.getElementById('websiteFrame');
                const html = frame.contentDocument.documentElement.outerHTML;

                await github.saveFile(state.currentPage, '<!DOCTYPE html>\n' + html, `√Ñnderungen an ${state.currentPage}`);

                state.hasWebsiteChanges = false;
                state.websiteChanges = [];
                updateStatus('saved');
                renderChangesList();
                toast('Gespeichert!', 'success');
            } catch (e) {
                toast('Fehler beim Speichern', 'error');
            }

            hideLoading();
        }

        // ============================================
        // BLOG EDITOR
        // ============================================
        function loadDrafts() {
            const saved = localStorage.getItem('blog_drafts');
            if (saved) state.drafts = JSON.parse(saved);
            renderPostList();
        }

        function saveDraftsToStorage() {
            localStorage.setItem('blog_drafts', JSON.stringify(state.drafts));
        }

        function createNewPost() {
            const post = {
                id: Date.now(),
                title: '',
                excerpt: '',
                content: '<p>Beginne hier mit deinem Beitrag...</p>',
                categories: [],
                featuredImage: null,
                featuredImageAlt: '',
                metaTitle: '',
                metaDescription: '',
                slug: '',
                status: 'draft',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            state.drafts.unshift(post);
            state.currentPost = post;
            saveDraftsToStorage();
            renderPostList();
            loadPostToEditor(post);
            toast('Neuer Entwurf', 'success');
        }

        function loadPostToEditor(post) {
            document.getElementById('postTitle').value = post.title || '';
            document.getElementById('postExcerpt').value = post.excerpt || '';
            document.getElementById('postContent').innerHTML = post.content || '<p></p>';
            document.getElementById('metaTitle').value = post.metaTitle || '';
            document.getElementById('metaDescription').value = post.metaDescription || '';
            document.getElementById('urlSlug').value = post.slug || '';
            document.getElementById('featuredImageAlt').value = post.featuredImageAlt || '';

            state.selectedCategories = post.categories || [];
            document.querySelectorAll('.category-tag').forEach(tag => {
                tag.classList.toggle('active', state.selectedCategories.includes(tag.dataset.cat));
            });

            const upload = document.getElementById('featuredImageUpload');
            if (post.featuredImage) {
                upload.innerHTML = `<img src="${post.featuredImage}" alt="">`;
                upload.classList.add('has-image');
                state.featuredImage = post.featuredImage;
            } else {
                upload.innerHTML = '<div style="color: var(--text-light); font-size: 0.85rem;"><div style="font-size: 2rem; margin-bottom: 0.5rem;">üì∑</div>Bild hochladen</div>';
                upload.classList.remove('has-image');
                state.featuredImage = null;
            }

            updateStats();
            updateMetaCount();
            state.hasBlogChanges = false;
        }

        function saveCurrentPostToState() {
            if (!state.currentPost) return;
            state.currentPost.title = document.getElementById('postTitle').value;
            state.currentPost.excerpt = document.getElementById('postExcerpt').value;
            state.currentPost.content = document.getElementById('postContent').innerHTML;
            state.currentPost.categories = state.selectedCategories;
            state.currentPost.featuredImage = state.featuredImage;
            state.currentPost.featuredImageAlt = document.getElementById('featuredImageAlt').value;
            state.currentPost.metaTitle = document.getElementById('metaTitle').value;
            state.currentPost.metaDescription = document.getElementById('metaDescription').value;
            state.currentPost.slug = document.getElementById('urlSlug').value || generateSlug(state.currentPost.title);
            state.currentPost.updatedAt = new Date().toISOString();
        }

        function renderPostList() {
            const container = document.getElementById('postList');
            const posts = state.currentBlogTab === 'drafts'
                ? state.drafts.filter(p => p.status === 'draft')
                : state.drafts.filter(p => p.status === 'published');

            if (posts.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-light);">Keine Beitr√§ge</div>';
                return;
            }

            container.innerHTML = posts.map(post => `
                <div class="post-item ${post.status} ${state.currentPost?.id === post.id ? 'active' : ''}" onclick="selectPost(${post.id})">
                    <div class="post-item-title">${post.title || 'Ohne Titel'}</div>
                    <div class="post-item-meta">
                        <span class="post-status-badge ${post.status}">${post.status === 'draft' ? 'Entwurf' : 'Ver√∂ffentlicht'}</span>
                        <span>${formatDate(post.updatedAt)}</span>
                    </div>
                </div>
            `).join('');
        }

        function selectPost(id) {
            if (state.currentPost && state.hasBlogChanges) {
                saveCurrentPostToState();
                saveDraftsToStorage();
            }
            const post = state.drafts.find(p => p.id === id);
            if (post) {
                state.currentPost = post;
                loadPostToEditor(post);
                renderPostList();
            }
        }

        function showBlogTab(tab) {
            state.currentBlogTab = tab;
            document.querySelectorAll('.blog-tab').forEach(t => {
                t.classList.toggle('active', t.textContent.toLowerCase().includes(tab === 'drafts' ? 'entw√ºrf' : 'ver√∂ffentlicht'));
            });
            renderPostList();
        }

        async function publishPost() {
            if (!state.currentPost) {
                toast('Kein Beitrag ausgew√§hlt', 'error');
                return;
            }

            saveCurrentPostToState();

            if (!state.currentPost.title) {
                toast('Bitte einen Titel eingeben', 'error');
                return;
            }

            showLoading('Ver√∂ffentliche...');

            try {
                const html = generateBlogPostHTML(state.currentPost);
                const filename = state.currentPost.slug + '.html';

                await github.saveFile(filename, html, `Blog: ${state.currentPost.title}`);

                state.currentPost.status = 'published';
                state.currentPost.publishedAt = new Date().toISOString();
                saveDraftsToStorage();

                addToQueue({ ...state.currentPost, queueStatus: 'published' });

                renderPostList();
                toast('Ver√∂ffentlicht!', 'success');
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            }

            hideLoading();
        }

        function schedulePost() {
            if (!state.currentPost) { toast('Kein Beitrag', 'error'); return; }

            const date = document.getElementById('scheduleDate').value;
            const time = document.getElementById('scheduleTime').value;

            if (!date) { toast('Bitte Datum w√§hlen', 'error'); return; }

            saveCurrentPostToState();
            state.currentPost.status = 'scheduled';
            state.currentPost.scheduledFor = `${date}T${time}:00`;
            saveDraftsToStorage();

            addToQueue({ ...state.currentPost, queueStatus: 'scheduled' });
            renderPostList();
            toast(`Geplant f√ºr ${formatDate(state.currentPost.scheduledFor)}`, 'success');
        }

        function generateBlogPostHTML(post) {
            return `<!doctype html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>${escapeHtml(post.metaTitle || post.title)} - KATHRIN STAHL</title>
    <meta name="description" content="${escapeHtml(post.metaDescription || post.excerpt)}" />
    <link rel="canonical" href="https://nickheymann.github.io/kathrin-coaching/${post.slug}.html" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="${escapeHtml(post.title)}" />
    ${post.featuredImage ? `<meta property="og:image" content="${post.featuredImage}" />` : ''}
    <style>
        body { font-family: Georgia, serif; line-height: 1.8; color: #333; max-width: 800px; margin: 0 auto; padding: 2rem; }
        h1 { color: #2C4A47; font-size: 2.5rem; margin-bottom: 0.5rem; }
        .meta { color: #666; margin-bottom: 2rem; font-size: 0.9rem; }
        .featured-image { width: 100%; border-radius: 12px; margin-bottom: 2rem; }
        h2 { color: #2C4A47; font-size: 1.6rem; margin-top: 2rem; }
        h3 { color: #2C4A47; font-size: 1.3rem; }
        blockquote { border-left: 4px solid #D4A574; padding-left: 1.5rem; font-style: italic; color: #666; }
        img { max-width: 100%; border-radius: 8px; }
        a { color: #D4A574; }
        .back { display: inline-block; margin-bottom: 1.5rem; color: #D4A574; text-decoration: none; }
    </style>
</head>
<body>
    <a href="blog.html" class="back">‚Üê Zur√ºck zum Blog</a>
    <article>
        <h1>${escapeHtml(post.title)}</h1>
        <div class="meta">Von Kathrin Stahl ¬∑ ${formatDate(new Date().toISOString())} ¬∑ ${calculateReadingTime(post.content)} Min. Lesezeit</div>
        ${post.featuredImage ? `<img src="${post.featuredImage}" alt="${escapeHtml(post.featuredImageAlt || post.title)}" class="featured-image">` : ''}
        <div class="content">${post.content}</div>
    </article>
<script src="js/header-loader.js"></script>
</body>
</html>`;
        }

        // ============================================
        // QUEUE
        // ============================================
        function loadQueue() {
            const saved = localStorage.getItem('blog_queue');
            if (saved) state.queue = JSON.parse(saved);
        }

        function saveQueueToStorage() {
            localStorage.setItem('blog_queue', JSON.stringify(state.queue));
        }

        function addToQueue(item) {
            state.queue.unshift(item);
            saveQueueToStorage();
        }

        function renderQueue() {
            const scheduled = state.queue.filter(i => i.queueStatus === 'scheduled');
            const published = state.queue.filter(i => i.queueStatus === 'published');

            document.getElementById('scheduledCount').textContent = scheduled.length;
            document.getElementById('publishedCount').textContent = published.length;

            document.getElementById('scheduledQueue').innerHTML = scheduled.length === 0
                ? '<div class="queue-empty"><div class="queue-empty-icon">üìÖ</div><p>Keine geplanten Beitr√§ge</p></div>'
                : scheduled.map((item, i) => `
                    <div class="queue-item scheduled">
                        <div class="queue-item-content">
                            <div class="queue-item-title">${escapeHtml(item.title)}</div>
                            <div class="queue-item-meta">Geplant: ${formatDate(item.scheduledFor)}</div>
                        </div>
                        <div class="queue-item-actions">
                            <button onclick="publishQueueItem(${i})" style="background: var(--success); color: white;">Jetzt</button>
                            <button onclick="removeFromQueue(${i})" style="background: var(--error); color: white;">√ó</button>
                        </div>
                    </div>
                `).join('');

            document.getElementById('publishedQueue').innerHTML = published.length === 0
                ? '<div class="queue-empty"><div class="queue-empty-icon">üìù</div><p>Noch keine ver√∂ffentlichten Beitr√§ge</p></div>'
                : published.slice(0, 10).map(item => `
                    <div class="queue-item published">
                        <div class="queue-item-content">
                            <div class="queue-item-title">${escapeHtml(item.title)}</div>
                            <div class="queue-item-meta">Ver√∂ffentlicht: ${formatDate(item.publishedAt)}</div>
                        </div>
                    </div>
                `).join('');
        }

        function removeFromQueue(index) {
            state.queue.splice(index, 1);
            saveQueueToStorage();
            renderQueue();
        }

        async function publishQueueItem(index) {
            const item = state.queue[index];
            if (!item) return;

            showLoading('Ver√∂ffentliche...');

            try {
                const html = generateBlogPostHTML(item);
                await github.saveFile(item.slug + '.html', html, `Blog: ${item.title}`);

                item.queueStatus = 'published';
                item.publishedAt = new Date().toISOString();

                const draft = state.drafts.find(d => d.id === item.id);
                if (draft) {
                    draft.status = 'published';
                    draft.publishedAt = item.publishedAt;
                    saveDraftsToStorage();
                }

                saveQueueToStorage();
                renderQueue();
                renderPostList();
                toast('Ver√∂ffentlicht!', 'success');
            } catch (e) {
                toast('Fehler', 'error');
            }

            hideLoading();
        }

        // ============================================
        // EDITOR COMMANDS
        // ============================================
        function execCmd(cmd, val = null) {
            document.execCommand(cmd, false, val);
            document.getElementById('postContent').focus();
        }

        function formatBlock(tag) {
            document.execCommand('formatBlock', false, `<${tag}>`);
            document.getElementById('postContent').focus();
        }

        function insertLink() {
            const url = prompt('Link-URL:');
            if (url) execCmd('createLink', url);
        }

        function insertVideo() {
            const url = prompt('YouTube oder Vimeo URL:');
            if (!url) return;

            let embedUrl = '';
            const ytMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/);
            if (ytMatch) embedUrl = `https://www.youtube.com/embed/${ytMatch[1]}`;

            const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
            if (vimeoMatch) embedUrl = `https://player.vimeo.com/video/${vimeoMatch[1]}`;

            if (embedUrl) {
                execCmd('insertHTML', `<div style="position:relative;padding-bottom:56.25%;height:0;margin:1.5rem 0;"><iframe src="${embedUrl}" style="position:absolute;top:0;left:0;width:100%;height:100%;" frameborder="0" allowfullscreen></iframe></div>`);
            } else {
                toast('Ung√ºltige URL', 'error');
            }
        }

        // ============================================
        // IMAGES
        // ============================================
        function openImageModal() {
            document.getElementById('imageModal').classList.add('open');
            loadImageGallery();
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('open');
            state.selectedImage = null;
        }

        async function loadImageGallery() {
            const gallery = document.getElementById('imageGallery');
            gallery.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-light);">Lade...</div>';

            const images = await github.listImages();
            if (images.length === 0) {
                gallery.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-light);">Keine Bilder</div>';
                return;
            }

            gallery.innerHTML = images.map(img => `
                <div class="gallery-item" style="background-image: url('${img.download_url}')" data-url="${img.download_url}" onclick="selectGalleryImage(this)"></div>
            `).join('');
        }

        function selectGalleryImage(el) {
            document.querySelectorAll('.gallery-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            state.selectedImage = el.dataset.url;
        }

        function insertSelectedImage() {
            const alt = document.getElementById('imageAltText').value;
            if (state.selectedImage) {
                execCmd('insertHTML', `<img src="${state.selectedImage}" alt="${escapeHtml(alt)}">`);
                closeImageModal();
                toast('Bild eingef√ºgt', 'success');
            } else {
                toast('Bitte Bild w√§hlen', 'error');
            }
        }

        async function uploadFeaturedImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';

            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file || file.size > 10 * 1024 * 1024) {
                    toast('Max 10MB', 'error');
                    return;
                }

                showLoading('Lade hoch...');

                const reader = new FileReader();
                reader.onload = async (e) => {
                    const base64 = e.target.result;
                    const filename = `featured-${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.]/g, '-')}`;

                    try {
                        await github.uploadImage(filename, base64);
                        state.featuredImage = `wp-content/uploads/blog/${filename}`;

                        const upload = document.getElementById('featuredImageUpload');
                        upload.innerHTML = `<img src="${base64}" alt="">`;
                        upload.classList.add('has-image');

                        state.hasBlogChanges = true;
                        toast('Hochgeladen', 'success');
                    } catch (e) {
                        toast('Fehler', 'error');
                    }
                    hideLoading();
                };
                reader.readAsDataURL(file);
            };

            input.click();
        }

        // ============================================
        // PREVIEW
        // ============================================
        function openPreview() {
            saveCurrentPostToState();
            const frame = document.getElementById('previewFrame');
            frame.innerHTML = generatePreviewHTML(state.currentPost);
            document.getElementById('previewModal').classList.add('open');
        }

        function closePreview() {
            document.getElementById('previewModal').classList.remove('open');
        }

        function setPreviewDevice(device) {
            document.querySelectorAll('.preview-device-btn').forEach(b => b.classList.toggle('active', b.textContent.toLowerCase() === device));
            document.getElementById('previewFrame').className = 'preview-frame ' + device;
        }

        function generatePreviewHTML(post) {
            return `<div style="padding: 2rem; font-family: Georgia, serif; max-width: 800px; margin: 0 auto;">
                <h1 style="color: #2C4A47; font-size: 2rem;">${escapeHtml(post?.title || 'Titel')}</h1>
                <div style="color: #666; font-size: 0.9rem; margin-bottom: 1.5rem;">Von Kathrin Stahl ¬∑ ${formatDate(new Date().toISOString())}</div>
                ${post?.featuredImage ? `<img src="${post.featuredImage}" style="width: 100%; border-radius: 12px; margin-bottom: 1.5rem;" alt="${post">` : ''}
                <div style="line-height: 1.8;">${post?.content || '<p>Kein Inhalt</p>'}</div>
            </div>`;
        }

        // ============================================
        // CATEGORIES
        // ============================================
        function setupCategoryTags() {
            document.querySelectorAll('.category-tag').forEach(tag => {
                tag.onclick = () => {
                    tag.classList.toggle('active');
                    const cat = tag.dataset.cat;
                    if (tag.classList.contains('active')) {
                        if (!state.selectedCategories.includes(cat)) state.selectedCategories.push(cat);
                    } else {
                        state.selectedCategories = state.selectedCategories.filter(c => c !== cat);
                    }
                    state.hasBlogChanges = true;
                };
            });
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            document.getElementById('postTitle').onblur = () => {
                const slug = document.getElementById('urlSlug');
                if (!slug.value) slug.value = generateSlug(document.getElementById('postTitle').value);
            };

            document.addEventListener('keydown', (e) => {
                const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
                const cmd = isMac ? e.metaKey : e.ctrlKey;

                if (cmd && e.key === 's') {
                    e.preventDefault();
                    if (state.currentMode === 'website') saveWebsiteChanges();
                    else if (state.currentMode === 'blog') {
                        saveCurrentPostToState();
                        saveDraftsToStorage();
                        toast('Entwurf gespeichert', 'success');
                    }
                }

                if (e.key === 'Escape') {
                    closePreview();
                    closeImageModal();
                }
            });

            window.onbeforeunload = () => {
                if (state.hasWebsiteChanges || state.hasBlogChanges) return 'Ungespeicherte √Ñnderungen!';
            };

            // Image drop zone
            const dropZone = document.getElementById('imageDropZone');
            const fileInput = document.getElementById('imageFileInput');

            dropZone.onclick = () => fileInput.click();
            fileInput.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) await uploadAndInsertImage(file);
            };

            dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('dragover'); };
            dropZone.ondragleave = () => dropZone.classList.remove('dragover');
            dropZone.ondrop = async (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file?.type.startsWith('image/')) await uploadAndInsertImage(file);
            };
        }

        async function uploadAndInsertImage(file) {
            if (file.size > 10 * 1024 * 1024) { toast('Max 10MB', 'error'); return; }

            showLoading('Lade hoch...');

            const reader = new FileReader();
            reader.onload = async (e) => {
                const base64 = e.target.result;
                const filename = `${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.]/g, '-')}`;

                try {
                    await github.uploadImage(filename, base64);
                    state.selectedImage = `wp-content/uploads/blog/${filename}`;
                    document.getElementById('imageDropZone').innerHTML = `<img src="${base64}" style="max-height: 120px; border-radius: 8px;" alt="${base64}"><div style="margin-top: 0.5rem;">Hochgeladen!</div>`;
                    toast('Bild hochgeladen', 'success');
                } catch (e) {
                    toast('Fehler', 'error');
                }
                hideLoading();
            };
            reader.readAsDataURL(file);
        }

        // ============================================
        // AUTOSAVE
        // ============================================
        function startAutosave() {
            setInterval(() => {
                if (state.hasBlogChanges && state.currentPost) {
                    saveCurrentPostToState();
                    saveDraftsToStorage();
                    state.hasBlogChanges = false;
                    updateStatus('autosaved');
                }
            }, CONFIG.autosaveInterval);

            // Check scheduled posts
            setInterval(() => {
                const now = new Date();
                state.queue.forEach((item, i) => {
                    if (item.queueStatus === 'scheduled' && new Date(item.scheduledFor) <= now) {
                        publishQueueItem(i);
                    }
                });
            }, 60000);
        }

        // ============================================
        // UTILITIES
        // ============================================
        function onBlogChange() {
            state.hasBlogChanges = true;
            updateStatus('unsaved');
            updateStats();
        }

        function updateStatus(status) {
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');

            dot.className = 'status-dot';

            switch (status) {
                case 'saved': text.textContent = 'Gespeichert'; break;
                case 'autosaved': text.textContent = 'Automatisch gespeichert'; break;
                case 'unsaved': text.textContent = 'Ungespeichert'; dot.classList.add('warning'); break;
                case 'error': text.textContent = 'Fehler'; dot.classList.add('error'); break;
                default: text.textContent = 'Bereit';
            }
        }

        function updateStats() {
            const content = document.getElementById('postContent')?.innerText || '';
            const words = content.trim().split(/\s+/).filter(w => w.length > 0).length;
            document.getElementById('wordCount').textContent = words;
            document.getElementById('charCount').textContent = content.length;
            document.getElementById('readingTime').textContent = Math.max(1, Math.ceil(words / 200));
        }

        function updateMetaCount() {
            document.getElementById('metaTitleCount').textContent = document.getElementById('metaTitle').value.length;
            document.getElementById('metaDescCount').textContent = document.getElementById('metaDescription').value.length;
        }

        function calculateReadingTime(html) {
            const text = html.replace(/<[^>]*>/g, '');
            return Math.max(1, Math.ceil(text.trim().split(/\s+/).filter(w => w.length > 0).length / 200));
        }

        function generateSlug(title) {
            return (title || '')
                .toLowerCase()
                .replace(/√§/g, 'ae').replace(/√∂/g, 'oe').replace(/√º/g, 'ue').replace(/√ü/g, 'ss')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '')
                .substring(0, 60);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text || '';
            return div.innerHTML;
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            return new Date(dateStr).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        function showLoading(text) {
            document.getElementById('loadingText').textContent = text || 'L√§dt...';
            document.getElementById('loadingOverlay').classList.add('visible');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('visible');
        }

        function toast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const t = document.createElement('div');
            t.className = `toast ${type}`;
            t.textContent = message;
            container.appendChild(t);
            setTimeout(() => t.remove(), 4000);
        }

        function showHelp() {
            alert(`Content Studio - Hilfe

üåê WEBSITE BEARBEITEN
‚Ä¢ W√§hle eine Seite aus dem Dropdown
‚Ä¢ Klicke auf Texte um sie zu bearbeiten
‚Ä¢ Klicke auf Bilder um sie zu ersetzen
‚Ä¢ Cmd+S zum Speichern

‚úèÔ∏è BLOG SCHREIBEN
‚Ä¢ Klicke auf "+ Neuer Beitrag"
‚Ä¢ Schreibe Titel und Inhalt
‚Ä¢ Formatiere mit der Toolbar
‚Ä¢ F√ºge Bilder und Videos ein
‚Ä¢ W√§hle Kategorien und SEO-Einstellungen
‚Ä¢ Klicke auf "Ver√∂ffentlichen"

üì§ VER√ñFFENTLICHUNG
‚Ä¢ Plane Beitr√§ge f√ºr sp√§ter
‚Ä¢ Sieh alle geplanten und ver√∂ffentlichten Posts
‚Ä¢ Geplante Posts werden automatisch ver√∂ffentlicht

Bei Fragen: Melde dich bei Nick!`);
        }

        function mainAction() {
            if (state.currentMode === 'website') saveWebsiteChanges();
            else if (state.currentMode === 'blog') publishPost();
        }

        // ============================================
        // INIT
        // ============================================
        document.addEventListener('DOMContentLoaded', checkSetup);
    </script>
<script src="js/header-loader.js"></script>
</body>
</html>
