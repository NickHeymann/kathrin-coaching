<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com" rel="preconnect"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="default-src 'self'; script-src 'self' 'nonce-blog-editor-2024' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; connect-src https://api.github.com https://raw.githubusercontent.com https://api.groq.com https://www.googleapis.com; img-src 'self' https: data: blob:; media-src 'self' https: blob:;" http-equiv="Content-Security-Policy"/>
<title>Blog Editor - Gl√ºck √ºber Zweifel</title>
<style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #2C4A47;
            --primary-light: #3d5f5b;
            --accent: #D4A574;
            --accent-hover: #c49564;
            --bg: #f8f6f3;
            --bg-dark: #1a1a1a;
            --text: #333;
            --text-light: #666;
            --border: #ddd;
            --success: #4CAF50;
            --warning: #ff9800;
            --error: #f44336;
            --info: #2196F3;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* ============================================
           HEADER / TOOLBAR
           ============================================ */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--accent);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .header-center {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }
        .status-dot.draft { background: var(--warning); }
        .status-dot.error { background: var(--error); }

        .header-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-ghost {
            background: transparent;
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .btn-ghost:hover { background: rgba(255,255,255,0.1); }

        .btn-primary {
            background: var(--accent);
            color: white;
        }
        .btn-primary:hover { background: var(--accent-hover); }

        .btn-success {
            background: var(--success);
            color: white;
        }
        .btn-success:hover { background: #43a047; }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        /* ============================================
           MAIN LAYOUT
           ============================================ */
        .main-container {
            display: flex;
            margin-top: 60px;
            height: calc(100vh - 60px);
        }

        /* ============================================
           SIDEBAR - Post List & Drafts
           ============================================ */
        .sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header h2 {
            font-size: 1rem;
            color: var(--primary);
        }

        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-light);
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .sidebar-tab:hover { background: var(--bg); }
        .sidebar-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .post-item {
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            margin-bottom: 0.5rem;
            border: 1px solid transparent;
        }
        .post-item:hover { background: var(--bg); }
        .post-item.active {
            background: #e8f5e9;
            border-color: var(--success);
        }
        .post-item.draft {
            border-left: 3px solid var(--warning);
        }

        .post-title {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .post-meta {
            font-size: 0.75rem;
            color: var(--text-light);
            display: flex;
            gap: 0.5rem;
        }

        .post-status {
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .post-status.draft { background: #fff3e0; color: #e65100; }
        .post-status.scheduled { background: #e3f2fd; color: #1565c0; }
        .post-status.published { background: #e8f5e9; color: #2e7d32; }

        .new-post-btn {
            margin: 0.5rem;
            padding: 0.75rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: background 0.15s;
        }
        .new-post-btn:hover { background: var(--primary-light); }

        /* ============================================
           EDITOR AREA
           ============================================ */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            overflow: hidden;
        }

        .editor-toolbar {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.75rem 1rem;
            background: #fafafa;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding-right: 0.75rem;
            margin-right: 0.75rem;
            border-right: 1px solid var(--border);
        }
        .toolbar-group:last-child {
            border-right: none;
            margin-right: 0;
        }

        .toolbar-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text);
            transition: all 0.1s;
        }
        .toolbar-btn:hover { background: #e0e0e0; }
        .toolbar-btn.active { background: var(--primary); color: white; }

        .toolbar-select {
            padding: 0.4rem 0.6rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
            cursor: pointer;
        }

        .editor-main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .editor-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            max-width: 900px;
            margin: 0 auto;
        }

        .title-input {
            width: 100%;
            font-size: 2.5rem;
            font-weight: 700;
            border: none;
            outline: none;
            color: var(--primary);
            margin-bottom: 1rem;
            font-family: 'Gilda Display', Georgia, serif;
        }
        .title-input::placeholder { color: #ccc; }

        .excerpt-input {
            width: 100%;
            font-size: 1.1rem;
            border: none;
            outline: none;
            color: var(--text-light);
            margin-bottom: 1.5rem;
            padding: 0.75rem;
            background: var(--bg);
            border-radius: 8px;
            resize: none;
        }

        .content-editor {
            min-height: 400px;
            border: none;
            outline: none;
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text);
        }
        .content-editor:focus { outline: none; }
        .content-editor p { margin-bottom: 1rem; }
        .content-editor h2 { font-size: 1.8rem; margin: 2rem 0 1rem; color: var(--primary); }
        .content-editor h3 { font-size: 1.4rem; margin: 1.5rem 0 0.75rem; color: var(--primary); }
        .content-editor blockquote {
            border-left: 4px solid var(--accent);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: var(--text-light);
        }
        .content-editor ul, .content-editor ol {
            margin: 1rem 0 1rem 2rem;
        }
        .content-editor li { margin-bottom: 0.5rem; }
        .content-editor img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        .content-editor a { color: var(--accent); }

        /* ============================================
           SETTINGS PANEL (Right Side)
           ============================================ */
        .settings-panel {
            width: 320px;
            background: #fafafa;
            border-left: 1px solid var(--border);
            overflow-y: auto;
            flex-shrink: 0;
        }

        .settings-section {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .settings-section h3 {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-row {
            margin-bottom: 1rem;
        }

        .settings-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 0.35rem;
            display: block;
        }

        .settings-input {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .settings-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .settings-textarea {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.85rem;
            resize: vertical;
            min-height: 80px;
        }

        .featured-image-upload {
            width: 100%;
            aspect-ratio: 16/9;
            background: var(--bg);
            border: 2px dashed var(--border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
            position: relative;
        }
        .featured-image-upload:hover { border-color: var(--primary); background: #f0f0f0; }
        .featured-image-upload.has-image { border-style: solid; }
        .featured-image-upload img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .featured-image-upload .upload-text {
            text-align: center;
            color: var(--text-light);
            font-size: 0.85rem;
        }
        .featured-image-upload .upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .category-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .category-tag {
            padding: 0.35rem 0.7rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.15s;
        }
        .category-tag:hover { border-color: var(--primary); }
        .category-tag.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .schedule-picker {
            display: flex;
            gap: 0.5rem;
        }
        .schedule-picker input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        /* ============================================
           PUBLISHING QUEUE PANEL
           ============================================ */
        .queue-panel {
            position: fixed;
            right: -400px;
            top: 60px;
            width: 400px;
            height: calc(100vh - 60px);
            background: white;
            box-shadow: -5px 0 20px rgba(0,0,0,0.1);
            z-index: 999;
            transition: right 0.3s;
            display: flex;
            flex-direction: column;
        }
        .queue-panel.open { right: 0; }

        .queue-header {
            padding: 1rem;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .queue-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .queue-item {
            padding: 1rem;
            background: var(--bg);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--info);
        }
        .queue-item.scheduled { border-left-color: var(--warning); }
        .queue-item.publishing { border-left-color: var(--info); animation: pulse 1.5s infinite; }
        .queue-item.published { border-left-color: var(--success); }
        .queue-item.error { border-left-color: var(--error); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .queue-item-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .queue-item-meta {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .queue-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .queue-actions button {
            padding: 0.35rem 0.7rem;
            border: none;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        /* ============================================
           PREVIEW MODAL
           ============================================ */
        .preview-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .preview-modal.open { display: flex; }

        .preview-container {
            width: 90%;
            max-width: 900px;
            height: 90%;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            padding: 1rem;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .preview-device-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .preview-device-btn {
            padding: 0.4rem 0.8rem;
            background: white;
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
        }
        .preview-device-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .preview-content {
            flex: 1;
            overflow: auto;
            display: flex;
            justify-content: center;
            padding: 1rem;
            background: #e0e0e0;
        }

        .preview-frame {
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            overflow: auto;
            transition: width 0.3s;
        }
        .preview-frame.desktop { width: 100%; }
        .preview-frame.tablet { width: 768px; }
        .preview-frame.mobile { width: 375px; }

        /* ============================================
           SETUP SCREEN
           ============================================ */
        .setup-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--bg) 0%, #ece8e1 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }
        .setup-screen.hidden { display: none; }

        .setup-card {
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
        }

        .setup-card h1 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .setup-card p {
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        .setup-input {
            width: 100%;
            padding: 0.9rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        .setup-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .setup-btn {
            width: 100%;
            padding: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }
        .setup-btn:hover { background: var(--primary-light); }

        .setup-link {
            display: block;
            margin-top: 1rem;
            color: var(--accent);
            text-decoration: none;
        }

        /* ============================================
           TOAST NOTIFICATIONS
           ============================================ */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 4000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            padding: 0.75rem 1.25rem;
            background: var(--text);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideIn 0.3s;
        }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--error); }
        .toast.warning { background: var(--warning); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ============================================
           IMAGE UPLOAD MODAL
           ============================================ */
        .image-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 2500;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .image-modal.open { display: flex; }

        .image-modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
        }

        .image-modal-header {
            padding: 1rem;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .image-modal-body {
            padding: 1.5rem;
        }

        .image-drop-zone {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .image-drop-zone:hover, .image-drop-zone.dragover {
            border-color: var(--primary);
            background: var(--bg);
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .gallery-item {
            aspect-ratio: 1;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s;
        }
        .gallery-item:hover { border-color: var(--primary); }
        .gallery-item.selected { border-color: var(--success); }

        /* ============================================
           WORD COUNT & READING TIME
           ============================================ */
        .editor-stats {
            position: fixed;
            bottom: 1rem;
            left: 320px;
            background: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 0.8rem;
            color: var(--text-light);
            display: flex;
            gap: 1rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        /* ============================================
           AUTOSAVE INDICATOR
           ============================================ */
        .autosave-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.8);
        }

        .autosave-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        /* ============================================
           AI ASSISTANT PANEL
           ============================================ */
        .ai-panel {
            position: fixed;
            right: -420px;
            top: 60px;
            width: 420px;
            height: calc(100vh - 60px);
            background: white;
            box-shadow: -5px 0 30px rgba(0,0,0,0.15);
            z-index: 1001;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .ai-panel.open { right: 0; }

        .ai-panel-header {
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ai-panel-header h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .ai-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .ai-section {
            background: var(--bg);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .ai-section h4 {
            font-size: 0.9rem;
            color: var(--primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ai-btn {
            width: 100%;
            padding: 0.75rem 1rem;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            text-align: left;
        }
        .ai-btn:hover { border-color: var(--primary); background: #f8f8f8; }
        .ai-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .ai-btn.loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .ai-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        .ai-btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd6 0%, #6a4190 100%);
        }

        .ai-result {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 0.75rem;
            font-size: 0.9rem;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }

        .ai-result.suggestion {
            border-left: 3px solid #667eea;
        }

        .ai-suggestion-item {
            padding: 0.75rem;
            background: var(--bg);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.15s;
        }
        .ai-suggestion-item:hover { background: #e8e8e8; }

        .ai-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .ai-category-tag {
            padding: 0.4rem 0.8rem;
            background: white;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        .ai-category-tag.suggested {
            border-color: #667eea;
            background: #f0f2ff;
            color: #667eea;
        }

        /* Voice Input */
        .voice-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .voice-btn:hover { transform: scale(1.05); }
        .voice-btn.recording {
            background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
            animation: voicePulse 1s infinite;
        }

        @keyframes voicePulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4); }
            50% { box-shadow: 0 0 0 20px rgba(244, 67, 54, 0); }
        }

        .voice-status {
            text-align: center;
            margin-top: 0.75rem;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .voice-transcript {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            min-height: 80px;
            font-size: 0.9rem;
            color: var(--text);
        }

        /* YouTube Ideas */
        .youtube-idea {
            padding: 1rem;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.15s;
        }
        .youtube-idea:hover { border-color: #ff0000; }

        .youtube-idea-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .youtube-idea-desc {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* AI Setup Modal */
        .ai-setup-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 3001;
            display: none;
            align-items: center;
            justify-content: center;
        }
        .ai-setup-modal.open { display: flex; }

        .ai-setup-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }

        .ai-setup-card h2 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .ai-setup-card p {
            color: var(--text-light);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .ai-setup-card a {
            color: #667eea;
        }

        /* Smart Formatting Toolbar */
        .smart-format-bar {
            position: absolute;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            padding: 0.5rem;
            display: none;
            gap: 0.25rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 100;
        }
        .smart-format-bar.visible { display: flex; }

        .smart-format-btn {
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }
        .smart-format-btn:hover { background: rgba(255,255,255,0.2); }

        /* AI Header Button */
        .ai-header-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.15s;
        }
        .ai-header-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(102,126,234,0.3); }

        /* Toolbar AI Button */
        .toolbar-btn.ai {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .toolbar-btn.ai:hover {
            background: linear-gradient(135deg, #5a6fd6 0%, #6a4190 100%);
        }
    </style>
</head>
<body>
<!-- Setup Screen -->
<div class="setup-screen" id="setupScreen">
<div class="setup-card">
<div>‚úé</div>
<h1>Blog Editor</h1>
<p>Schreibe und ver√∂ffentliche Blog-Posts direkt auf deiner Website.</p>
<input class="setup-input" id="tokenInput" placeholder="GitHub Token eingeben..." type="password"/>
<button class="setup-btn" onclick="setupToken()">Editor starten</button>
<a class="setup-link" href="cms-editor.html">Zur√ºck zum Website-Editor</a>
</div>
</div>
<!-- Header -->
<div class="header">
<div class="header-left">
<div class="logo">
<div class="logo-icon">‚úé</div>
                Blog Editor
            </div>
</div>
<div class="header-center">
<div class="autosave-indicator">

<span id="autosaveText">Autosave aktiv</span>
</div>
<div>

<span id="statusText">Bereit</span>
</div>
</div>
<div class="header-right">
<button class="ai-header-btn" onclick="toggleAIPanel()">‚ú® KI-Assistent</button>
<button class="btn btn-ghost" onclick="openPreview()">Vorschau</button>
<button class="btn btn-ghost" onclick="toggleQueue()">Warteschlange</button>
<button class="btn btn-ghost" onclick="saveDraft()">Entwurf speichern</button>
<button class="btn btn-success" onclick="publishPost()">Ver√∂ffentlichen</button>
</div>
</div>
<!-- Main Container -->
<div class="main-container">
<!-- Sidebar -->
<div class="sidebar">
<div>
<h2>Beitr√§ge</h2>
</div>
<div>
<button class="active" onclick="showTab('drafts')">Entw√ºrfe</button>
<button onclick="showTab('published')">Ver√∂ffentlicht</button>
<button onclick="showTab('scheduled')">Geplant</button>
</div>
<button class="new-post-btn" onclick="createNewPost()">
<span>+</span> Neuer Beitrag
            </button>

</div>
<!-- Editor -->
<div class="editor-container">
<!-- Toolbar -->
<div class="editor-toolbar">
<div class="toolbar-group">
<select class="toolbar-select" id="blockType" onchange="formatBlock(this.value)">
<option value="p">Absatz</option>
<option value="h2">√úberschrift 2</option>
<option value="h3">√úberschrift 3</option>
<option value="h4">√úberschrift 4</option>
<option value="blockquote">Zitat</option>
</select>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="execCmd('bold')" title="Fett (Cmd+B)"><strong>B</strong></button>
<button class="toolbar-btn" onclick="execCmd('italic')" title="Kursiv (Cmd+I)"><em>I</em></button>
<button class="toolbar-btn" onclick="execCmd('underline')" title="Unterstrichen (Cmd+U)"><u>U</u></button>
<button class="toolbar-btn" onclick="execCmd('strikeThrough')" title="Durchgestrichen"><s>S</s></button>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="execCmd('insertUnorderedList')" title="Aufz√§hlung">‚Ä¢</button>
<button class="toolbar-btn" onclick="execCmd('insertOrderedList')" title="Nummerierung">1.</button>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="insertLink()" title="Link einf√ºgen">üîó</button>
<button class="toolbar-btn" onclick="openImageModal()" title="Bild einf√ºgen">üì∑</button>
<button class="toolbar-btn" onclick="insertVideo()" title="Video einf√ºgen">üé•</button>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="execCmd('justifyLeft')" title="Links">‚á§</button>
<button class="toolbar-btn" onclick="execCmd('justifyCenter')" title="Zentriert">‚Üî</button>
<button class="toolbar-btn" onclick="execCmd('justifyRight')" title="Rechts">‚á•</button>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="execCmd('undo')" title="R√ºckg√§ngig (Cmd+Z)">‚Ü∂</button>
<button class="toolbar-btn" onclick="execCmd('redo')" title="Wiederholen (Cmd+Shift+Z)">‚Ü∑</button>
</div>
<div class="toolbar-group">
<button class="toolbar-btn" onclick="toggleFullscreen()" title="Vollbild">‚õ∂</button>
</div>
<div class="toolbar-group">
<button class="toolbar-btn ai" onclick="aiImproveText()" title="Text mit KI verbessern">‚ú®</button>
<button class="toolbar-btn" onclick="toggleVoiceInput()" title="Spracheingabe" id="voiceToolbarBtn">üé§</button>
</div>
</div>
<!-- Editor Content -->
<div class="editor-main">
<div class="editor-content">
<input class="title-input" id="postTitle" oninput="onContentChange()" placeholder="Titel eingeben..." type="text"/>
<textarea class="excerpt-input" id="postExcerpt" oninput="onContentChange()" placeholder="Kurzbeschreibung f√ºr SEO und Vorschau..." rows="2"></textarea>
<div class="content-editor" contenteditable="true" id="postContent" oninput="onContentChange()">
<p>Beginne hier mit deinem Beitrag...</p>
</div>
</div>
</div>
</div>
<!-- Settings Panel -->
<div class="settings-panel">
<div class="settings-section">
<h3>üì∑ Beitragsbild</h3>
<div class="featured-image-upload" id="featuredImageUpload" onclick="uploadFeaturedImage()">
<div class="upload-text">
<div class="upload-icon">üì∑</div>
<div>Bild hochladen oder ziehen</div>
</div>
</div>
<div class="settings-row">
<label class="settings-label">Alt-Text (SEO)</label>
<input class="settings-input" id="featuredImageAlt" placeholder="Bildbeschreibung f√ºr SEO..." type="text"/>
</div>
</div>
<div class="settings-section">
<h3>üìÅ Kategorien</h3>
<div id="categoryTags">
<span data-cat="achtsamkeit">Achtsamkeit</span>
<span data-cat="selbstliebe">Selbstliebe</span>
<span data-cat="beziehung">Beziehung</span>
<span data-cat="pferdecoaching">Pferdecoaching</span>
<span data-cat="heldinnenreise">Heldinnenreise</span>
<span data-cat="podcast">Podcast</span>
</div>
</div>
<div class="settings-section">
<h3>üîñ SEO</h3>
<div class="settings-row">
<label class="settings-label">Meta-Titel</label>
<input class="settings-input" id="metaTitle" placeholder="SEO Titel (max 60 Zeichen)" type="text"/>

<span id="metaTitleCount">0</span>/60 Zeichen
                    
</div>
<div class="settings-row">
<label class="settings-label">Meta-Beschreibung</label>
<textarea class="settings-textarea" id="metaDescription" placeholder="SEO Beschreibung (max 160 Zeichen)"></textarea>

<span id="metaDescCount">0</span>/160 Zeichen
                    
</div>
<div class="settings-row">
<label class="settings-label">URL-Slug</label>
<input class="settings-input" id="urlSlug" placeholder="url-freundlicher-name" type="text"/>
</div>
</div>
<div class="settings-section">
<h3>üìÖ Ver√∂ffentlichung</h3>
<div class="settings-row">
<label class="settings-label">Zeitplan</label>

</div>
<button class="btn btn-primary" onclick="schedulePost()">
                    Planen
                </button>
</div>
<div class="settings-section">
<h3>‚öô Autor</h3>
<div class="settings-row">
<label class="settings-label">Autor</label>
<input class="settings-input" id="authorName" type="text" value="Kathrin Stahl"/>
</div>
</div>
</div>
</div>
<!-- Publishing Queue Panel -->
<div class="queue-panel" id="queuePanel">
<div class="queue-header">
<h3>Ver√∂ffentlichungs-Warteschlange</h3>
<button class="btn btn-ghost" onclick="toggleQueue()">√ó</button>
</div>

</div>
<!-- Preview Modal -->
<div class="preview-modal" id="previewModal">
<div class="preview-container">
<div class="preview-header">
<h3>Vorschau</h3>
<div class="preview-device-toggle">
<button class="preview-device-btn active" onclick="setPreviewDevice('desktop')">Desktop</button>
<button class="preview-device-btn" onclick="setPreviewDevice('tablet')">Tablet</button>
<button class="preview-device-btn" onclick="setPreviewDevice('mobile')">Mobil</button>
</div>
<button class="btn btn-ghost" onclick="closePreview()">√ó Schlie√üen</button>
</div>

</div>
</div>
<!-- Image Upload Modal -->
<div class="image-modal" id="imageModal">
<div class="image-modal-content">
<div class="image-modal-header">
<h3>Bild einf√ºgen</h3>
<button class="btn btn-ghost" onclick="closeImageModal()">√ó</button>
</div>
<div class="image-modal-body">
<div class="image-drop-zone" id="imageDropZone">
<div>üì∑</div>
<div>Bild hierher ziehen oder klicken zum Ausw√§hlen</div>
<input accept="image/*" id="imageFileInput" type="file"/>
</div>
<h4>Oder aus Mediathek w√§hlen:</h4>

<div>
<label class="settings-label">Alt-Text</label>
<input class="settings-input" id="imageAltText" placeholder="Bildbeschreibung..." type="text"/>
</div>
<button class="btn btn-primary" onclick="insertSelectedImage()">
                    Bild einf√ºgen
                </button>
</div>
</div>
</div>
<!-- Editor Stats -->
<div class="editor-stats">
<div class="stat-item">
<span>üìù</span>
<span id="wordCount">0</span> W√∂rter
        </div>
<div class="stat-item">
<span>üïë</span>
<span id="readingTime">0</span> Min. Lesezeit
        </div>
<div class="stat-item">
<span>üìÑ</span>
<span id="charCount">0</span> Zeichen
        </div>
</div>
<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- AI Assistant Panel -->
<div class="ai-panel" id="aiPanel">
    <div class="ai-panel-header">
        <h3>‚ú® KI-Assistent</h3>
        <button class="btn btn-ghost" onclick="toggleAIPanel()" style="padding: 0.25rem 0.5rem;">√ó</button>
    </div>
    <div class="ai-panel-content">
        <!-- Voice Input Section -->
        <div class="ai-section">
            <h4>üé§ Spracheingabe</h4>
            <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceInput()">üé§</button>
            <div class="voice-status" id="voiceStatus">Klicke zum Sprechen</div>
            <div class="voice-transcript" id="voiceTranscript" style="display: none;"></div>
            <button class="ai-btn" id="insertVoiceBtn" onclick="insertVoiceText()" style="display: none; margin-top: 0.5rem;">
                ‚Üì Text einf√ºgen
            </button>
        </div>

        <!-- AI Writing Assistance -->
        <div class="ai-section">
            <h4>‚úçÔ∏è Schreibhilfe</h4>
            <button class="ai-btn" onclick="aiImproveGrammar()" id="btnGrammar">
                üìù Grammatik & Stil verbessern
            </button>
            <button class="ai-btn" onclick="aiChangeTone('warmherzig')" id="btnTone">
                üíù Warmherziger Ton
            </button>
            <button class="ai-btn" onclick="aiShortenText()" id="btnShorten">
                ‚úÇÔ∏è Text k√ºrzen
            </button>
            <button class="ai-btn" onclick="aiExpandText()" id="btnExpand">
                üìñ Text erweitern
            </button>
            <div class="ai-result" id="aiWritingResult" style="display: none;"></div>
            <button class="ai-btn ai-btn-primary" id="applyAIBtn" onclick="applyAISuggestion()" style="display: none;">
                ‚úì √Ñnderung √ºbernehmen
            </button>
        </div>

        <!-- Auto-Categorization -->
        <div class="ai-section">
            <h4>üè∑Ô∏è Automatische Kategorisierung</h4>
            <button class="ai-btn ai-btn-primary" onclick="aiCategorize()" id="btnCategorize">
                üîÆ Kategorien vorschlagen
            </button>
            <div class="ai-categories" id="aiCategories"></div>
        </div>

        <!-- Content Generation -->
        <div class="ai-section">
            <h4>üìù Inhalt generieren</h4>
            <button class="ai-btn" onclick="aiGenerateSummary()" id="btnSummary">
                üìã Zusammenfassung erstellen
            </button>
            <button class="ai-btn" onclick="aiGenerateTitle()" id="btnTitle">
                üí° Titel vorschlagen
            </button>
            <button class="ai-btn" onclick="aiGenerateMetaDescription()" id="btnMeta">
                üîç Meta-Beschreibung (SEO)
            </button>
            <button class="ai-btn" onclick="aiGenerateOutline()" id="btnOutline">
                üìë Gliederung erstellen
            </button>
            <div class="ai-result" id="aiContentResult" style="display: none;"></div>
        </div>

        <!-- YouTube Topic Ideas -->
        <div class="ai-section">
            <h4>üé¨ Themenvorschl√§ge aus Videos</h4>
            <p style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 0.75rem;">
                Basierend auf Kathrins neuesten YouTube-Videos
            </p>
            <button class="ai-btn" onclick="loadYouTubeIdeas()" id="btnYouTube">
                üîÑ Ideen laden
            </button>
            <div id="youtubeIdeas"></div>
        </div>

        <!-- Smart Formatting -->
        <div class="ai-section">
            <h4>üé® Smart-Formatierung</h4>
            <button class="ai-btn" onclick="insertHighlightBox()" id="btnHighlight">
                üí° Highlight-Box einf√ºgen
            </button>
            <button class="ai-btn" onclick="insertCallout()" id="btnCallout">
                üìå Callout einf√ºgen
            </button>
            <button class="ai-btn" onclick="insertBlockquote()" id="btnQuote">
                ‚ùù Inspirierendes Zitat
            </button>
            <button class="ai-btn" onclick="aiFormatForReadability()" id="btnReadability">
                üìñ Lesbarkeit verbessern
            </button>
        </div>
    </div>
</div>

<!-- AI Setup Modal -->
<div class="ai-setup-modal" id="aiSetupModal">
    <div class="ai-setup-card">
        <h2>‚ú® KI-Assistent einrichten</h2>
        <p>
            Um den KI-Assistenten zu nutzen, ben√∂tigst du einen kostenlosen Groq API-Key.<br><br>
            <a href="https://console.groq.com/keys" target="_blank">‚Üí Groq API Key erstellen (kostenlos)</a>
        </p>
        <input class="setup-input" id="groqKeyInput" placeholder="gsk_xxxxxxxxxxxxx" type="password"/>
        <button class="setup-btn" onclick="saveGroqKey()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            KI aktivieren
        </button>
        <button class="btn btn-ghost" onclick="closeAISetup()" style="width: 100%; margin-top: 0.5rem; color: var(--text-light);">
            Sp√§ter einrichten
        </button>
    </div>
</div>
<!-- DOMPurify f√ºr sichere HTML-Sanitization -->
<script crossorigin="anonymous" integrity="sha384-3XJAN3rswrHdGqLHC3V5s0ERRmJrqtOvC/1qVz8gg4RZMlWBNB9VCRa9Z6H/TqRt" nonce="blog-editor-2024" src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
<script nonce="blog-editor-2024">
        // ============================================
        // SECURITY UTILITIES
        // ============================================
        function escapeHtml(unsafe) {
            if (unsafe == null) return '';
            return String(unsafe)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function sanitizeHTML(dirty) {
            if (typeof DOMPurify !== 'undefined') {
                return DOMPurify.sanitize(dirty, {
                    ALLOWED_TAGS: ['p', 'br', 'b', 'i', 'u', 'strong', 'em', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
                                   'ul', 'ol', 'li', 'a', 'img', 'blockquote', 'pre', 'code', 'div', 'span',
                                   'table', 'thead', 'tbody', 'tr', 'th', 'td', 'hr', 'figure', 'figcaption'],
                    ALLOWED_ATTR: ['href', 'src', 'alt', 'title', 'class', 'id', 'style', 'target', 'rel',
                                   'width', 'height', 'loading'],
                    FORBID_TAGS: ['script', 'iframe', 'object', 'embed', 'form'],
                    FORBID_ATTR: ['onerror', 'onload', 'onclick', 'onmouseover']
                });
            }
            return escapeHtml(dirty);
        }

        // Sichere UTF-8 Base64 Encoding (ersetzt deprecated unescape)
        function utf8ToBase64(str) {
            return btoa(new TextEncoder().encode(str).reduce((data, byte) => data + String.fromCharCode(byte), ''));
        }

        function base64ToUtf8(base64) {
            const binary = atob(base64);
            const bytes = new Uint8Array(binary.length);
            for (let i = 0; i < binary.length; i++) {
                bytes[i] = binary.charCodeAt(i);
            }
            return new TextDecoder().decode(bytes);
        }

        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            owner: 'nickheymann',
            repo: 'kathrin-coaching',
            branch: 'main',
            autosaveInterval: 30000 // 30 Sekunden
        };

        // ============================================
        // STATE
        // ============================================
        let state = {
            token: null,
            currentPost: null,
            posts: [],
            drafts: [],
            queue: [],
            hasUnsavedChanges: false,
            selectedCategories: [],
            featuredImage: null,
            selectedImage: null,
            currentTab: 'drafts'
        };

        // ============================================
        // GITHUB API
        // ============================================
        const github = {
            async request(endpoint, options = {}) {
                const response = await fetch(`https://api.github.com${endpoint}`, {
                    ...options,
                    headers: {
                        'Authorization': `token ${state.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });

                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }

                return response.json();
            },

            async getFile(path) {
                try {
                    const data = await this.request(
                        `/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${path}?ref=${CONFIG.branch}`
                    );
                    return {
                        content: atob(data.content),
                        sha: data.sha
                    };
                } catch (e) {
                    return null;
                }
            },

            async saveFile(path, content, message) {
                const existing = await this.getFile(path);

                const body = {
                    message: message,
                    content: utf8ToBase64(content),
                    branch: CONFIG.branch
                };

                if (existing) {
                    body.sha = existing.sha;
                }

                return this.request(
                    `/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${path}`,
                    { method: 'PUT', body: JSON.stringify(body) }
                );
            },

            async uploadImage(filename, base64Data) {
                const content = base64Data.split(',')[1];

                const body = {
                    message: `Bild hochgeladen: ${filename}`,
                    content: content,
                    branch: CONFIG.branch
                };

                return this.request(
                    `/repos/${CONFIG.owner}/${CONFIG.repo}/contents/wp-content/uploads/blog/${filename}`,
                    { method: 'PUT', body: JSON.stringify(body) }
                );
            },

            async listImages() {
                try {
                    const data = await this.request(
                        `/repos/${CONFIG.owner}/${CONFIG.repo}/contents/wp-content/uploads?ref=${CONFIG.branch}`
                    );

                    // Rekursiv Bilder suchen
                    const images = [];
                    for (const item of data) {
                        if (item.type === 'dir') {
                            try {
                                const subData = await this.request(
                                    `/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${item.path}?ref=${CONFIG.branch}`
                                );
                                for (const subItem of subData) {
                                    if (subItem.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
                                        images.push(subItem);
                                    }
                                }
                            } catch (e) {}
                        }
                    }
                    return images.slice(0, 30); // Nur die ersten 30
                } catch (e) {
                    return [];
                }
            }
        };

        // ============================================
        // SETUP & INIT (Token in sessionStorage f√ºr Sicherheit)
        // ============================================
        function checkSetup() {
            // Zuerst sessionStorage pr√ºfen
            let savedToken = sessionStorage.getItem('github_token');

            // Migration von localStorage (einmalig)
            if (!savedToken) {
                const oldToken = localStorage.getItem('github_token');
                if (oldToken) {
                    sessionStorage.setItem('github_token', oldToken);
                    localStorage.removeItem('github_token');
                    savedToken = oldToken;
                    console.log('Token von localStorage zu sessionStorage migriert');
                }
            }

            if (savedToken) {
                state.token = savedToken;
                document.getElementById('setupScreen').classList.add('hidden');
                initEditor();
            }
        }

        async function setupToken() {
            const token = document.getElementById('tokenInput').value.trim();
            if (!token) {
                toast('Bitte Token eingeben', 'error');
                return;
            }

            try {
                state.token = token;
                await github.request(`/repos/${CONFIG.owner}/${CONFIG.repo}`);

                // Token in sessionStorage speichern (sicherer)
                sessionStorage.setItem('github_token', token);
                localStorage.removeItem('github_token'); // Alte Tokens entfernen
                document.getElementById('setupScreen').classList.add('hidden');
                toast('Erfolgreich eingerichtet!', 'success');
                initEditor();
            } catch (e) {
                toast('Token ung√ºltig', 'error');
                state.token = null;
            }
        }

        function initEditor() {
            loadDrafts();
            loadQueue();
            setupCategoryTags();
            setupEventListeners();
            startAutosave();
            updateStats();
        }

        // ============================================
        // DRAFTS & POSTS
        // ============================================
        function loadDrafts() {
            const saved = localStorage.getItem('blog_drafts');
            if (saved) {
                state.drafts = JSON.parse(saved);
            }
            renderPostList();
        }

        function saveDraftsToStorage() {
            localStorage.setItem('blog_drafts', JSON.stringify(state.drafts));
        }

        function createNewPost() {
            const post = {
                id: Date.now(),
                title: '',
                excerpt: '',
                content: '<p>Beginne hier mit deinem Beitrag...</p>',
                categories: [],
                featuredImage: null,
                featuredImageAlt: '',
                metaTitle: '',
                metaDescription: '',
                slug: '',
                status: 'draft',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            state.drafts.unshift(post);
            state.currentPost = post;
            saveDraftsToStorage();
            renderPostList();
            loadPostToEditor(post);
            toast('Neuer Entwurf erstellt', 'success');
        }

        function loadPostToEditor(post) {
            document.getElementById('postTitle').value = post.title || '';
            document.getElementById('postExcerpt').value = post.excerpt || '';
            document.getElementById('postContent').innerHTML = post.content || '<p></p>';
            document.getElementById('metaTitle').value = post.metaTitle || '';
            document.getElementById('metaDescription').value = post.metaDescription || '';
            document.getElementById('urlSlug').value = post.slug || '';
            document.getElementById('featuredImageAlt').value = post.featuredImageAlt || '';

            // Kategorien
            state.selectedCategories = post.categories || [];
            document.querySelectorAll('.category-tag').forEach(tag => {
                tag.classList.toggle('active', state.selectedCategories.includes(tag.dataset.cat));
            });

            // Featured Image
            const upload = document.getElementById('featuredImageUpload');
            if (post.featuredImage) {
                upload.innerHTML = `<img src="${post.featuredImage}" alt="" loading="lazy">`;
                upload.classList.add('has-image');
                state.featuredImage = post.featuredImage;
            } else {
                upload.innerHTML = `
                    <div class="upload-text">
                        <div class="upload-icon">&#128247;</div>
                        <div>Bild hochladen oder ziehen</div>
                    </div>
                `;
                upload.classList.remove('has-image');
                state.featuredImage = null;
            }

            updateStats();
            state.hasUnsavedChanges = false;
        }

        function saveCurrentPostToState() {
            if (!state.currentPost) return;

            state.currentPost.title = document.getElementById('postTitle').value;
            state.currentPost.excerpt = document.getElementById('postExcerpt').value;
            state.currentPost.content = document.getElementById('postContent').innerHTML;
            state.currentPost.categories = state.selectedCategories;
            state.currentPost.featuredImage = state.featuredImage;
            state.currentPost.featuredImageAlt = document.getElementById('featuredImageAlt').value;
            state.currentPost.metaTitle = document.getElementById('metaTitle').value;
            state.currentPost.metaDescription = document.getElementById('metaDescription').value;
            state.currentPost.slug = document.getElementById('urlSlug').value || generateSlug(state.currentPost.title);
            state.currentPost.updatedAt = new Date().toISOString();
        }

        function saveDraft() {
            saveCurrentPostToState();
            saveDraftsToStorage();
            state.hasUnsavedChanges = false;
            updateStatus('saved');
            toast('Entwurf gespeichert', 'success');
        }

        function renderPostList() {
            const container = document.getElementById('postList');
            let posts = [];

            if (state.currentTab === 'drafts') {
                posts = state.drafts.filter(p => p.status === 'draft');
            } else if (state.currentTab === 'scheduled') {
                posts = state.drafts.filter(p => p.status === 'scheduled');
            } else {
                posts = state.drafts.filter(p => p.status === 'published');
            }

            if (posts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-light);">
                        <p>Keine Beitr√§ge vorhanden</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = posts.map(post => `
                <div class="post-item ${post.status} ${state.currentPost?.id === post.id ? 'active' : ''}"
                     onclick="selectPost(${post.id})">
                    <div class="post-title">${post.title || 'Ohne Titel'}</div>
                    <div class="post-meta">
                        <span class="post-status ${post.status}">${getStatusLabel(post.status)}</span>
                        <span>${formatDate(post.updatedAt)}</span>
                    </div>
                </div>
            `).join('');
        }

        function selectPost(id) {
            // Aktuellen Post speichern
            if (state.currentPost && state.hasUnsavedChanges) {
                saveCurrentPostToState();
                saveDraftsToStorage();
            }

            // Neuen Post laden
            const post = state.drafts.find(p => p.id === id);
            if (post) {
                state.currentPost = post;
                loadPostToEditor(post);
                renderPostList();
            }
        }

        function showTab(tab) {
            state.currentTab = tab;
            document.querySelectorAll('.sidebar-tab').forEach(t => {
                t.classList.toggle('active', t.textContent.toLowerCase().includes(tab));
            });
            renderPostList();
        }

        // ============================================
        // PUBLISHING
        // ============================================
        async function publishPost() {
            if (!state.currentPost) {
                toast('Kein Beitrag ausgew√§hlt', 'error');
                return;
            }

            saveCurrentPostToState();

            if (!state.currentPost.title) {
                toast('Bitte einen Titel eingeben', 'error');
                return;
            }

            updateStatus('publishing');
            toast('Ver√∂ffentliche...', 'info');

            try {
                // HTML generieren
                const html = generateBlogPostHTML(state.currentPost);
                const filename = state.currentPost.slug + '.html';

                // Auf GitHub speichern
                await github.saveFile(filename, html, `Blog-Post ver√∂ffentlicht: ${state.currentPost.title}`);

                // blog.html aktualisieren (neuen Post zur Liste hinzuf√ºgen)
                await updateBlogIndex(state.currentPost);

                // Status updaten
                state.currentPost.status = 'published';
                state.currentPost.publishedAt = new Date().toISOString();
                saveDraftsToStorage();

                // Zur Queue hinzuf√ºgen
                addToQueue({
                    ...state.currentPost,
                    queueStatus: 'published'
                });

                updateStatus('saved');
                renderPostList();
                toast('Erfolgreich ver√∂ffentlicht!', 'success');

            } catch (e) {
                console.error('Publishing error:', e);
                updateStatus('error');
                toast('Fehler beim Ver√∂ffentlichen: ' + e.message, 'error');
            }
        }

        function schedulePost() {
            if (!state.currentPost) {
                toast('Kein Beitrag ausgew√§hlt', 'error');
                return;
            }

            const date = document.getElementById('scheduleDate').value;
            const time = document.getElementById('scheduleTime').value;

            if (!date) {
                toast('Bitte ein Datum w√§hlen', 'error');
                return;
            }

            saveCurrentPostToState();

            state.currentPost.status = 'scheduled';
            state.currentPost.scheduledFor = `${date}T${time}:00`;
            saveDraftsToStorage();

            // Zur Queue hinzuf√ºgen
            addToQueue({
                ...state.currentPost,
                queueStatus: 'scheduled'
            });

            renderPostList();
            toast(`Geplant f√ºr ${formatDate(state.currentPost.scheduledFor)}`, 'success');
        }

        function generateBlogPostHTML(post) {
            const categories = post.categories.map(c => `category-${c}`).join(' ');
            const publishDate = new Date().toISOString();

            return `<!doctype html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>${escapeHtml(post.metaTitle || post.title)} - KATHRIN STAHL</title>
    <meta name="description" content="${escapeHtml(post.metaDescription || post.excerpt)}" />
    <link rel="canonical" href="https://nickheymann.github.io/kathrin-coaching/${post.slug}.html" />
    <meta property="og:locale" content="de_DE" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="${escapeHtml(post.metaTitle || post.title)} - KATHRIN STAHL" />
    <meta property="og:description" content="${escapeHtml(post.metaDescription || post.excerpt)}" />
    <meta property="og:url" content="https://nickheymann.github.io/kathrin-coaching/${post.slug}.html" />
    <meta property="og:site_name" content="KATHRIN STAHL" />
    <meta property="article:published_time" content="${publishDate}" />
    ${post.featuredImage ? `<meta property="og:image" content="${post.featuredImage}" />` : ''}
    <meta name="author" content="Kathrin Stahl" />

    <link rel='stylesheet' href='wp-content/themes/efor/css/main32d4.css' type='text/css' />
    <link rel='stylesheet' href='wp-content/themes/efor/style32d4.css' type='text/css' />
    <style>
        .blog-post-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            font-family: 'Georgia', serif;
            line-height: 1.8;
        }
        .blog-post-content h1 {
            font-family: 'Gilda Display', Georgia, serif;
            color: #2C4A47;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .blog-post-content .post-meta {
            color: #666;
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }
        .blog-post-content .featured-image {
            width: 100%;
            max-height: 500px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        .blog-post-content p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }
        .blog-post-content h2 {
            color: #2C4A47;
            font-size: 1.8rem;
            margin: 2rem 0 1rem;
        }
        .blog-post-content h3 {
            color: #2C4A47;
            font-size: 1.4rem;
            margin: 1.5rem 0 0.75rem;
        }
        .blog-post-content blockquote {
            border-left: 4px solid #D4A574;
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: #666;
        }
        .blog-post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        .blog-post-content a {
            color: #D4A574;
        }
        .blog-post-content ul, .blog-post-content ol {
            margin: 1rem 0 1rem 2rem;
        }
        .blog-post-content li {
            margin-bottom: 0.5rem;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 2rem;
            color: #D4A574;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="blog-post-content">
        <a href="blog.html" class="back-link">&larr; Zur√ºck zum Blog</a>

        <article class="${categories}">
            <h1>${escapeHtml(post.title)}</h1>

            <div class="post-meta">
                <span>Von Kathrin Stahl</span> &bull;
                <span>${formatDate(publishDate)}</span> &bull;
                <span>${calculateReadingTime(post.content)} Min. Lesezeit</span>
            </div>

            ${post.featuredImage ? `<img src="${post.featuredImage}" alt="${escapeHtml(post.featuredImageAlt || post.title)}" class="featured-image" loading="lazy">` : ''}

            <div class="entry-content">
                ${post.content}
            </div>
        </article>

        <hr style="margin: 3rem 0; border: none; border-top: 1px solid #ddd;">

        <div style="text-align: center;">
            <p>Mehr Inspiration findest du im <a href="blog.html">Blog</a> oder auf <a href="index.html">meiner Startseite</a>.</p>
        </div>
    </div>
</body>
</html>`;
        }

        async function updateBlogIndex(post) {
            // Dies w√ºrde den blog.html aktualisieren, um den neuen Post einzuf√ºgen
            // F√ºr jetzt loggen wir es nur
            console.log('Blog-Index w√ºrde aktualisiert mit:', post.title);
        }

        // ============================================
        // QUEUE MANAGEMENT
        // ============================================
        function loadQueue() {
            const saved = localStorage.getItem('blog_queue');
            if (saved) {
                state.queue = JSON.parse(saved);
            }
            renderQueue();
            checkScheduledPosts();
        }

        function saveQueueToStorage() {
            localStorage.setItem('blog_queue', JSON.stringify(state.queue));
        }

        function addToQueue(item) {
            state.queue.unshift(item);
            saveQueueToStorage();
            renderQueue();
        }

        function renderQueue() {
            const container = document.getElementById('queueContent');

            if (state.queue.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-light);">
                        <p>Keine Beitr√§ge in der Warteschlange</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = state.queue.map((item, index) => `
                <div class="queue-item ${item.queueStatus}">
                    <div class="queue-item-title">${escapeHtml(item.title || 'Ohne Titel')}</div>
                    <div class="queue-item-meta">
                        ${item.queueStatus === 'scheduled' ? `Geplant: ${formatDate(item.scheduledFor)}` : ''}
                        ${item.queueStatus === 'published' ? `Ver√∂ffentlicht: ${formatDate(item.publishedAt)}` : ''}
                        ${item.queueStatus === 'publishing' ? 'Wird ver√∂ffentlicht...' : ''}
                        ${item.queueStatus === 'error' ? 'Fehler beim Ver√∂ffentlichen' : ''}
                    </div>
                    <div class="queue-actions">
                        ${item.queueStatus === 'scheduled' ? `
                            <button onclick="publishNow(${index})" style="background: var(--success); color: white;">Jetzt ver√∂ffentlichen</button>
                            <button onclick="removeFromQueue(${index})" style="background: var(--error); color: white;">Entfernen</button>
                        ` : ''}
                        ${item.queueStatus === 'error' ? `
                            <button onclick="retryPublish(${index})" style="background: var(--warning); color: white;">Erneut versuchen</button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function toggleQueue() {
            document.getElementById('queuePanel').classList.toggle('open');
        }

        function removeFromQueue(index) {
            state.queue.splice(index, 1);
            saveQueueToStorage();
            renderQueue();
        }

        async function publishNow(index) {
            const item = state.queue[index];
            if (!item) return;

            item.queueStatus = 'publishing';
            renderQueue();

            try {
                const html = generateBlogPostHTML(item);
                const filename = item.slug + '.html';

                await github.saveFile(filename, html, `Blog-Post ver√∂ffentlicht: ${item.title}`);

                item.queueStatus = 'published';
                item.publishedAt = new Date().toISOString();

                // Draft Status updaten
                const draft = state.drafts.find(d => d.id === item.id);
                if (draft) {
                    draft.status = 'published';
                    draft.publishedAt = item.publishedAt;
                    saveDraftsToStorage();
                }

                saveQueueToStorage();
                renderQueue();
                renderPostList();
                toast('Erfolgreich ver√∂ffentlicht!', 'success');

            } catch (e) {
                item.queueStatus = 'error';
                saveQueueToStorage();
                renderQueue();
                toast('Fehler beim Ver√∂ffentlichen', 'error');
            }
        }

        function checkScheduledPosts() {
            // Alle 60 Sekunden pr√ºfen
            setInterval(() => {
                const now = new Date();

                state.queue.forEach((item, index) => {
                    if (item.queueStatus === 'scheduled' && item.scheduledFor) {
                        const scheduled = new Date(item.scheduledFor);
                        if (now >= scheduled) {
                            publishNow(index);
                        }
                    }
                });
            }, 60000);
        }

        // ============================================
        // EDITOR COMMANDS
        // ============================================
        function execCmd(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('postContent').focus();
        }

        function formatBlock(tag) {
            document.execCommand('formatBlock', false, `<${tag}>`);
            document.getElementById('postContent').focus();
        }

        function insertLink() {
            const url = prompt('Link-URL eingeben:');
            if (url) {
                execCmd('createLink', url);
            }
        }

        function insertVideo() {
            const url = prompt('YouTube oder Vimeo URL eingeben:');
            if (url) {
                let embedUrl = '';

                // YouTube
                const ytMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/);
                if (ytMatch) {
                    embedUrl = `https://www.youtube.com/embed/${ytMatch[1]}`;
                }

                // Vimeo
                const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
                if (vimeoMatch) {
                    embedUrl = `https://player.vimeo.com/video/${vimeoMatch[1]}`;
                }

                if (embedUrl) {
                    const html = `<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin: 1.5rem 0;">
                        <iframe src="${embedUrl}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" frameborder="0" allowfullscreen></iframe>
                    </div>`;
                    execCmd('insertHTML', html);
                } else {
                    toast('Ung√ºltige Video-URL', 'error');
                }
            }
        }

        function toggleFullscreen() {
            document.querySelector('.editor-container').classList.toggle('fullscreen');
        }

        // ============================================
        // IMAGE HANDLING
        // ============================================
        function openImageModal() {
            document.getElementById('imageModal').classList.add('open');
            loadImageGallery();
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('open');
            state.selectedImage = null;
        }

        async function loadImageGallery() {
            const gallery = document.getElementById('imageGallery');
            gallery.innerHTML = '<div style="text-align: center; padding: 1rem;">Lade Bilder...</div>';

            const images = await github.listImages();

            if (images.length === 0) {
                gallery.innerHTML = '<div style="text-align: center; padding: 1rem; color: var(--text-light);">Keine Bilder gefunden</div>';
                return;
            }

            gallery.innerHTML = images.map(img => `
                <div class="gallery-item"
                     style="background-image: url('${img.download_url}')"
                     data-url="${img.download_url}"
                     onclick="selectGalleryImage(this)">
                </div>
            `).join('');
        }

        function selectGalleryImage(el) {
            document.querySelectorAll('.gallery-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            state.selectedImage = el.dataset.url;
        }

        function insertSelectedImage() {
            const altText = document.getElementById('imageAltText').value;

            if (state.selectedImage) {
                const html = `<img src="${state.selectedImage}" alt="${escapeHtml(altText)}" loading="lazy">`;
                execCmd('insertHTML', html);
                closeImageModal();
                toast('Bild eingef√ºgt', 'success');
            } else {
                toast('Bitte ein Bild ausw√§hlen', 'error');
            }
        }

        async function uploadFeaturedImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';

            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (file.size > 10 * 1024 * 1024) {
                    toast('Bild zu gro√ü (max 10MB)', 'error');
                    return;
                }

                toast('Lade Bild hoch...', 'info');

                const reader = new FileReader();
                reader.onload = async (e) => {
                    const base64 = e.target.result;
                    const filename = `featured-${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.]/g, '-')}`;

                    try {
                        await github.uploadImage(filename, base64);

                        const imageUrl = `wp-content/uploads/blog/${filename}`;
                        state.featuredImage = imageUrl;

                        const upload = document.getElementById('featuredImageUpload');
                        upload.innerHTML = `<img src="${base64}" alt="" loading="lazy">`;
                        upload.classList.add('has-image');

                        state.hasUnsavedChanges = true;
                        toast('Bild hochgeladen', 'success');
                    } catch (e) {
                        toast('Fehler beim Hochladen', 'error');
                    }
                };
                reader.readAsDataURL(file);
            };

            input.click();
        }

        // Image Drop Zone
        function setupImageDropZone() {
            const dropZone = document.getElementById('imageDropZone');
            const fileInput = document.getElementById('imageFileInput');

            dropZone.onclick = () => fileInput.click();

            fileInput.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    await uploadAndInsertImage(file);
                }
            };

            dropZone.ondragover = (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            };

            dropZone.ondragleave = () => {
                dropZone.classList.remove('dragover');
            };

            dropZone.ondrop = async (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');

                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    await uploadAndInsertImage(file);
                }
            };
        }

        async function uploadAndInsertImage(file) {
            if (file.size > 10 * 1024 * 1024) {
                toast('Bild zu gro√ü (max 10MB)', 'error');
                return;
            }

            toast('Lade Bild hoch...', 'info');

            const reader = new FileReader();
            reader.onload = async (e) => {
                const base64 = e.target.result;
                const filename = `${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.]/g, '-')}`;

                try {
                    await github.uploadImage(filename, base64);

                    const imageUrl = `wp-content/uploads/blog/${filename}`;
                    state.selectedImage = imageUrl;

                    // Vorschau zeigen
                    document.getElementById('imageDropZone').innerHTML = `
                        <img src="${base64}" style="max-height: 150px; border-radius: 8px;" loading="lazy" alt="${base64}">
                        <div style="margin-top: 0.5rem;">Bild hochgeladen!</div>
                    `;

                    toast('Bild hochgeladen', 'success');
                } catch (e) {
                    toast('Fehler beim Hochladen', 'error');
                }
            };
            reader.readAsDataURL(file);
        }

        // ============================================
        // PREVIEW
        // ============================================
        function openPreview() {
            saveCurrentPostToState();

            const frame = document.getElementById('previewFrame');
            const html = generatePreviewHTML(state.currentPost);
            frame.innerHTML = html;

            document.getElementById('previewModal').classList.add('open');
        }

        function closePreview() {
            document.getElementById('previewModal').classList.remove('open');
        }

        function setPreviewDevice(device) {
            document.querySelectorAll('.preview-device-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(device));
            });

            const frame = document.getElementById('previewFrame');
            frame.className = 'preview-frame ' + device;
        }

        function generatePreviewHTML(post) {
            return `
                <div style="padding: 2rem; font-family: Georgia, serif; max-width: 800px; margin: 0 auto;">
                    <a href="#" style="color: #D4A574; display: block; margin-bottom: 1rem;">&larr; Zur√ºck zum Blog</a>

                    <h1 style="font-family: 'Gilda Display', Georgia, serif; color: #2C4A47; font-size: 2rem; margin-bottom: 0.5rem;">
                        ${escapeHtml(post?.title || 'Titel')}
                    </h1>

                    <div style="color: #666; font-size: 0.9rem; margin-bottom: 1.5rem;">
                        Von Kathrin Stahl &bull; ${formatDate(new Date().toISOString())} &bull;
                        ${calculateReadingTime(post?.content || '')} Min. Lesezeit
                    </div>

                    ${post?.featuredImage ? `<img src="${post.featuredImage}" style="width: 100%; border-radius: 12px; margin-bottom: 1.5rem;" loading="lazy" alt="${post">` : ''}

                    <div style="line-height: 1.8; font-size: 1.1rem;">
                        ${post?.content || '<p>Kein Inhalt</p>'}
                    </div>
                </div>
            `;
        }

        // ============================================
        // CATEGORIES
        // ============================================
        function setupCategoryTags() {
            document.querySelectorAll('.category-tag').forEach(tag => {
                tag.onclick = () => {
                    tag.classList.toggle('active');

                    const cat = tag.dataset.cat;
                    if (tag.classList.contains('active')) {
                        if (!state.selectedCategories.includes(cat)) {
                            state.selectedCategories.push(cat);
                        }
                    } else {
                        state.selectedCategories = state.selectedCategories.filter(c => c !== cat);
                    }

                    state.hasUnsavedChanges = true;
                };
            });
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            // SEO Character Counts
            document.getElementById('metaTitle').oninput = (e) => {
                document.getElementById('metaTitleCount').textContent = e.target.value.length;
                onContentChange();
            };

            document.getElementById('metaDescription').oninput = (e) => {
                document.getElementById('metaDescCount').textContent = e.target.value.length;
                onContentChange();
            };

            // Auto-generate slug from title
            document.getElementById('postTitle').onblur = () => {
                const slug = document.getElementById('urlSlug');
                if (!slug.value) {
                    slug.value = generateSlug(document.getElementById('postTitle').value);
                }
            };

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
                const cmdOrCtrl = isMac ? e.metaKey : e.ctrlKey;

                if (cmdOrCtrl && e.key === 's') {
                    e.preventDefault();
                    saveDraft();
                }

                if (e.key === 'Escape') {
                    closePreview();
                    closeImageModal();
                    document.getElementById('queuePanel').classList.remove('open');
                }
            });

            // Warn before leaving with unsaved changes
            window.onbeforeunload = () => {
                if (state.hasUnsavedChanges) {
                    return 'Du hast ungespeicherte √Ñnderungen.';
                }
            };

            // Setup image drop zone
            setupImageDropZone();
        }

        // ============================================
        // AUTOSAVE
        // ============================================
        function startAutosave() {
            setInterval(() => {
                if (state.hasUnsavedChanges && state.currentPost) {
                    saveCurrentPostToState();
                    saveDraftsToStorage();
                    state.hasUnsavedChanges = false;
                    updateStatus('autosaved');
                    console.log('Autosave:', new Date().toLocaleTimeString());
                }
            }, CONFIG.autosaveInterval);
        }

        // ============================================
        // UTILITIES
        // ============================================
        function onContentChange() {
            state.hasUnsavedChanges = true;
            updateStatus('unsaved');
            updateStats();
        }

        function updateStatus(status) {
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');
            const autosaveText = document.getElementById('autosaveText');

            dot.className = 'status-dot';

            switch (status) {
                case 'saved':
                    text.textContent = 'Gespeichert';
                    autosaveText.textContent = 'Alle √Ñnderungen gespeichert';
                    break;
                case 'autosaved':
                    text.textContent = 'Automatisch gespeichert';
                    autosaveText.textContent = 'Autosave aktiv';
                    break;
                case 'unsaved':
                    text.textContent = 'Ungespeichert';
                    dot.classList.add('draft');
                    autosaveText.textContent = '√Ñnderungen nicht gespeichert';
                    break;
                case 'publishing':
                    text.textContent = 'Ver√∂ffentliche...';
                    break;
                case 'error':
                    text.textContent = 'Fehler';
                    dot.classList.add('error');
                    break;
            }
        }

        function updateStats() {
            const content = document.getElementById('postContent')?.innerText || '';
            const words = content.trim().split(/\s+/).filter(w => w.length > 0).length;
            const chars = content.length;
            const readingTime = Math.max(1, Math.ceil(words / 200));

            document.getElementById('wordCount').textContent = words;
            document.getElementById('charCount').textContent = chars;
            document.getElementById('readingTime').textContent = readingTime;
        }

        function calculateReadingTime(html) {
            const text = html.replace(/<[^>]*>/g, '');
            const words = text.trim().split(/\s+/).filter(w => w.length > 0).length;
            return Math.max(1, Math.ceil(words / 200));
        }

        function generateSlug(title) {
            return title
                .toLowerCase()
                .replace(/√§/g, 'ae')
                .replace(/√∂/g, 'oe')
                .replace(/√º/g, 'ue')
                .replace(/√ü/g, 'ss')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '')
                .substring(0, 60);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text || '';
            return div.innerHTML;
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('de-DE', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function getStatusLabel(status) {
            const labels = {
                draft: 'Entwurf',
                scheduled: 'Geplant',
                published: 'Ver√∂ffentlicht',
                publishing: 'Wird ver√∂ffentlicht'
            };
            return labels[status] || status;
        }

        function toast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 4000);
        }

        // ============================================
        // AI ASSISTANT - GROQ API INTEGRATION
        // ============================================

        // AI State
        let aiState = {
            groqKey: null,
            isRecording: false,
            recognition: null,
            currentTranscript: '',
            lastAISuggestion: '',
            youtubeVideos: []
        };

        // Groq API Wrapper
        const groqAPI = {
            async call(systemPrompt, userContent, model = 'llama-3.1-8b-instant') {
                if (!aiState.groqKey) {
                    openAISetup();
                    throw new Error('Groq API Key nicht konfiguriert');
                }

                try {
                    const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${aiState.groqKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: model,
                            messages: [
                                { role: 'system', content: systemPrompt },
                                { role: 'user', content: userContent }
                            ],
                            temperature: 0.7,
                            max_tokens: 2048
                        })
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.error?.message || 'API Fehler');
                    }

                    const data = await response.json();
                    return data.choices[0].message.content;
                } catch (e) {
                    console.error('Groq API Error:', e);
                    throw e;
                }
            }
        };

        // AI Panel Toggle
        function toggleAIPanel() {
            const panel = document.getElementById('aiPanel');
            panel.classList.toggle('open');

            // Check if Groq Key exists
            if (!aiState.groqKey && panel.classList.contains('open')) {
                const savedKey = localStorage.getItem('groq_api_key');
                if (savedKey) {
                    aiState.groqKey = savedKey;
                }
            }
        }

        // AI Setup Modal
        function openAISetup() {
            document.getElementById('aiSetupModal').classList.add('open');
        }

        function closeAISetup() {
            document.getElementById('aiSetupModal').classList.remove('open');
        }

        function saveGroqKey() {
            const key = document.getElementById('groqKeyInput').value.trim();
            if (!key || !key.startsWith('gsk_')) {
                toast('Bitte einen g√ºltigen Groq API Key eingeben (beginnt mit gsk_)', 'error');
                return;
            }

            aiState.groqKey = key;
            localStorage.setItem('groq_api_key', key);
            closeAISetup();
            toast('KI-Assistent aktiviert!', 'success');
        }

        // Load Groq Key on init
        function initAI() {
            const savedKey = localStorage.getItem('groq_api_key');
            if (savedKey) {
                aiState.groqKey = savedKey;
            }
            initVoiceRecognition();
        }

        // ============================================
        // VOICE INPUT (Web Speech API)
        // ============================================

        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                aiState.recognition = new SpeechRecognition();
                aiState.recognition.continuous = true;
                aiState.recognition.interimResults = true;
                aiState.recognition.lang = 'de-DE';

                aiState.recognition.onresult = (event) => {
                    let interimTranscript = '';
                    let finalTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    aiState.currentTranscript += finalTranscript;

                    const transcriptEl = document.getElementById('voiceTranscript');
                    transcriptEl.innerHTML = aiState.currentTranscript +
                        (interimTranscript ? `<span style="color: #999;">${interimTranscript}</span>` : '');
                    transcriptEl.style.display = 'block';
                    document.getElementById('insertVoiceBtn').style.display = 'block';
                };

                aiState.recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    stopVoiceInput();
                    toast('Spracherkennung fehlgeschlagen: ' + event.error, 'error');
                };

                aiState.recognition.onend = () => {
                    if (aiState.isRecording) {
                        // Restart if still recording (browser auto-stops after silence)
                        aiState.recognition.start();
                    }
                };
            }
        }

        function toggleVoiceInput() {
            if (!aiState.recognition) {
                toast('Spracherkennung wird von diesem Browser nicht unterst√ºtzt', 'error');
                return;
            }

            if (aiState.isRecording) {
                stopVoiceInput();
            } else {
                startVoiceInput();
            }
        }

        function startVoiceInput() {
            aiState.isRecording = true;
            aiState.currentTranscript = '';
            aiState.recognition.start();

            document.getElementById('voiceBtn').classList.add('recording');
            document.getElementById('voiceToolbarBtn')?.classList.add('active');
            document.getElementById('voiceStatus').textContent = 'üî¥ Aufnahme l√§uft... Klicke zum Stoppen';
            document.getElementById('voiceTranscript').innerHTML = '';
            document.getElementById('voiceTranscript').style.display = 'block';
        }

        function stopVoiceInput() {
            aiState.isRecording = false;
            aiState.recognition?.stop();

            document.getElementById('voiceBtn').classList.remove('recording');
            document.getElementById('voiceToolbarBtn')?.classList.remove('active');
            document.getElementById('voiceStatus').textContent = 'Klicke zum Sprechen';
        }

        function insertVoiceText() {
            if (aiState.currentTranscript.trim()) {
                const editor = document.getElementById('postContent');

                // Insert at cursor position or append
                const selection = window.getSelection();
                if (selection.rangeCount > 0 && editor.contains(selection.anchorNode)) {
                    document.execCommand('insertText', false, aiState.currentTranscript);
                } else {
                    editor.innerHTML += `<p>${escapeHtml(aiState.currentTranscript)}</p>`;
                }

                aiState.currentTranscript = '';
                document.getElementById('voiceTranscript').innerHTML = '';
                document.getElementById('voiceTranscript').style.display = 'none';
                document.getElementById('insertVoiceBtn').style.display = 'none';

                onContentChange();
                toast('Text eingef√ºgt!', 'success');
            }
        }

        // ============================================
        // AI WRITING ASSISTANCE
        // ============================================

        function getSelectedOrAllText() {
            const selection = window.getSelection();
            const editor = document.getElementById('postContent');

            if (selection.toString().trim().length > 10) {
                return { text: selection.toString(), isSelection: true };
            }

            return { text: editor.innerText, isSelection: false };
        }

        function setButtonLoading(btnId, loading) {
            const btn = document.getElementById(btnId);
            if (btn) {
                btn.disabled = loading;
                btn.classList.toggle('loading', loading);
            }
        }

        async function aiImproveGrammar() {
            const { text, isSelection } = getSelectedOrAllText();
            if (text.length < 20) {
                toast('Bitte mehr Text schreiben oder ausw√§hlen', 'warning');
                return;
            }

            setButtonLoading('btnGrammar', true);

            try {
                const result = await groqAPI.call(
                    `Du bist ein einf√ºhlsamer deutscher Lektor f√ºr Coaching-Texte.
                    Verbessere Grammatik, Rechtschreibung und Stil, aber behalte die warmherzige,
                    pers√∂nliche Stimme der Autorin bei.
                    Gib NUR den verbesserten Text zur√ºck, keine Erkl√§rungen.`,
                    text
                );

                aiState.lastAISuggestion = result;
                showAIResult('aiWritingResult', result, isSelection);
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnGrammar', false);
            }
        }

        async function aiChangeTone(tone) {
            const { text, isSelection } = getSelectedOrAllText();
            if (text.length < 20) {
                toast('Bitte mehr Text schreiben oder ausw√§hlen', 'warning');
                return;
            }

            setButtonLoading('btnTone', true);

            try {
                const result = await groqAPI.call(
                    `Du bist eine erfahrene Coaching-Texterin.
                    Schreibe den folgenden Text in einem ${tone}en, einladenden Ton um.
                    Der Text soll sich anf√ºhlen wie eine pers√∂nliche Nachricht von einer Freundin.
                    Behalte die Kernaussage bei, aber mache den Ton w√§rmer und nahbarer.
                    Gib NUR den umgeschriebenen Text zur√ºck.`,
                    text
                );

                aiState.lastAISuggestion = result;
                showAIResult('aiWritingResult', result, isSelection);
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnTone', false);
            }
        }

        async function aiShortenText() {
            const { text, isSelection } = getSelectedOrAllText();
            if (text.length < 50) {
                toast('Text ist bereits kurz genug', 'warning');
                return;
            }

            setButtonLoading('btnShorten', true);

            try {
                const result = await groqAPI.call(
                    `Du bist eine pr√§zise Texterin. K√ºrze den folgenden Text auf etwa die H√§lfte.
                    Behalte die wichtigsten Aussagen und die emotionale Tiefe bei.
                    Entferne nur Wiederholungen und unn√∂tige F√ºllw√∂rter.
                    Gib NUR den gek√ºrzten Text zur√ºck.`,
                    text
                );

                aiState.lastAISuggestion = result;
                showAIResult('aiWritingResult', result, isSelection);
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnShorten', false);
            }
        }

        async function aiExpandText() {
            const { text, isSelection } = getSelectedOrAllText();
            if (text.length < 10) {
                toast('Bitte etwas Text schreiben zum Erweitern', 'warning');
                return;
            }

            setButtonLoading('btnExpand', true);

            try {
                const result = await groqAPI.call(
                    `Du bist eine einf√ºhlsame Coaching-Autorin wie Kathrin Stahl.
                    Erweitere den folgenden Text mit mehr emotionaler Tiefe und konkreten Beispielen.
                    F√ºge reflektierende Fragen hinzu, die den Leser zum Nachdenken anregen.
                    Der Ton soll warmherzig und einladend sein.
                    Gib NUR den erweiterten Text zur√ºck.`,
                    text
                );

                aiState.lastAISuggestion = result;
                showAIResult('aiWritingResult', result, isSelection);
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnExpand', false);
            }
        }

        async function aiImproveText() {
            // Quick improve from toolbar - improves selected text
            const selection = window.getSelection();
            if (selection.toString().trim().length < 10) {
                toast('Bitte Text ausw√§hlen zum Verbessern', 'warning');
                return;
            }

            toggleAIPanel();
            await aiImproveGrammar();
        }

        function showAIResult(elementId, text, canApply = true) {
            const el = document.getElementById(elementId);
            el.innerHTML = escapeHtml(text).replace(/\n/g, '<br>');
            el.style.display = 'block';

            if (canApply && elementId === 'aiWritingResult') {
                document.getElementById('applyAIBtn').style.display = 'block';
            }
        }

        function applyAISuggestion() {
            if (!aiState.lastAISuggestion) return;

            const selection = window.getSelection();
            const editor = document.getElementById('postContent');

            if (selection.toString().trim().length > 10 && editor.contains(selection.anchorNode)) {
                // Replace selection
                document.execCommand('insertText', false, aiState.lastAISuggestion);
            } else {
                // Replace entire content
                editor.innerHTML = aiState.lastAISuggestion.split('\n').map(p => `<p>${escapeHtml(p)}</p>`).join('');
            }

            // Hide result
            document.getElementById('aiWritingResult').style.display = 'none';
            document.getElementById('applyAIBtn').style.display = 'none';
            aiState.lastAISuggestion = '';

            onContentChange();
            toast('√Ñnderung √ºbernommen!', 'success');
        }

        // ============================================
        // AUTO-CATEGORIZATION
        // ============================================

        const BLOG_CATEGORIES = {
            achtsamkeit: 'Achtsamkeit',
            selbstliebe: 'Selbstliebe',
            beziehung: 'Beziehung',
            heldinnenreise: 'Heldinnenreise',
            hochbegabung: 'Hochbegabung',
            koerper: 'K√∂rper & Nervensystem'
        };

        async function aiCategorize() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').innerText;

            if (content.length < 50) {
                toast('Bitte mehr Inhalt schreiben f√ºr Kategorisierung', 'warning');
                return;
            }

            setButtonLoading('btnCategorize', true);

            try {
                const result = await groqAPI.call(
                    `Du analysierst Blog-Artikel f√ºr eine Coaching-Website.

                    Verf√ºgbare Kategorien:
                    - achtsamkeit: Pr√§senz, innere Ruhe, Momente, Meditation
                    - selbstliebe: Selbstakzeptanz, Selbstwert, innerer Kritiker
                    - beziehung: Partnerschaft, N√§he, Liebe, Kommunikation
                    - heldinnenreise: Pers√∂nliche Transformation, Neuanfang
                    - hochbegabung: Hochsensibilit√§t, anders sein, √úberreizung
                    - koerper: Nervensystem, K√∂rperarbeit, somatische Erfahrung

                    Analysiere den Text und gib die 1-3 passendsten Kategorien als kommaseparierte Liste zur√ºck.
                    NUR die Kategorie-IDs, keine Erkl√§rungen. Beispiel: achtsamkeit, selbstliebe`,
                    `Titel: ${title}\n\nInhalt: ${content.substring(0, 2000)}`
                );

                const categories = result.toLowerCase().split(',').map(c => c.trim()).filter(c => BLOG_CATEGORIES[c]);

                // Display suggestions
                const container = document.getElementById('aiCategories');
                container.innerHTML = categories.map(cat => `
                    <span class="ai-category-tag suggested" onclick="selectAICategory('${cat}')">
                        ${BLOG_CATEGORIES[cat]}
                    </span>
                `).join('');

                toast(`${categories.length} Kategorien vorgeschlagen`, 'success');
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnCategorize', false);
            }
        }

        function selectAICategory(categoryId) {
            // Add to selected categories
            const tag = document.querySelector(`[data-cat="${categoryId}"]`);
            if (tag && !tag.classList.contains('active')) {
                tag.click();
            }
            toast(`Kategorie "${BLOG_CATEGORIES[categoryId]}" hinzugef√ºgt`, 'success');
        }

        // ============================================
        // CONTENT GENERATION
        // ============================================

        async function aiGenerateSummary() {
            const content = document.getElementById('postContent').innerText;

            if (content.length < 100) {
                toast('Bitte mehr Inhalt schreiben f√ºr Zusammenfassung', 'warning');
                return;
            }

            setButtonLoading('btnSummary', true);

            try {
                const result = await groqAPI.call(
                    `Du erstellst kurze, einladende Zusammenfassungen f√ºr Blog-Artikel.
                    Schreibe eine 2-3 Satz Zusammenfassung, die:
                    - Die Kernbotschaft einf√§ngt
                    - Neugierig macht weiterzulesen
                    - Den warmherzigen Ton beibeh√§lt
                    Gib NUR die Zusammenfassung zur√ºck.`,
                    content.substring(0, 3000)
                );

                showAIResult('aiContentResult', result, false);

                // Offer to use as excerpt
                if (confirm('Zusammenfassung als Kurzbeschreibung verwenden?')) {
                    document.getElementById('postExcerpt').value = result;
                    onContentChange();
                }
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnSummary', false);
            }
        }

        async function aiGenerateTitle() {
            const content = document.getElementById('postContent').innerText;

            if (content.length < 100) {
                toast('Bitte mehr Inhalt schreiben f√ºr Titelvorschl√§ge', 'warning');
                return;
            }

            setButtonLoading('btnTitle', true);

            try {
                const result = await groqAPI.call(
                    `Du erstellst einladende Blog-Titel f√ºr eine Coaching-Website.
                    Erstelle 3 verschiedene Titelvorschl√§ge, die:
                    - Emotional ansprechen
                    - Neugierig machen
                    - Nicht l√§nger als 60 Zeichen sind
                    - Den Kern des Artikels einfangen

                    Format: Nummerierte Liste (1. 2. 3.)`,
                    content.substring(0, 2000)
                );

                showAIResult('aiContentResult', result, false);
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnTitle', false);
            }
        }

        async function aiGenerateMetaDescription() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').innerText;

            if (content.length < 100) {
                toast('Bitte mehr Inhalt schreiben', 'warning');
                return;
            }

            setButtonLoading('btnMeta', true);

            try {
                const result = await groqAPI.call(
                    `Du erstellst SEO-optimierte Meta-Beschreibungen.
                    Erstelle eine Meta-Beschreibung (max 155 Zeichen), die:
                    - Den Artikel zusammenfasst
                    - Zum Klicken einl√§dt
                    - Nat√ºrlich klingt (kein Keyword-Stuffing)
                    Gib NUR die Meta-Beschreibung zur√ºck.`,
                    `Titel: ${title}\n\nInhalt: ${content.substring(0, 1500)}`
                );

                document.getElementById('metaDescription').value = result.substring(0, 160);
                updateCharCount('metaDescription', 'metaDescCount', 160);
                onContentChange();
                toast('Meta-Beschreibung erstellt!', 'success');
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnMeta', false);
            }
        }

        async function aiGenerateOutline() {
            const title = document.getElementById('postTitle').value || 'Neuer Artikel';

            setButtonLoading('btnOutline', true);

            try {
                const result = await groqAPI.call(
                    `Du erstellst Blog-Gliederungen f√ºr eine Coaching-Website.
                    Erstelle eine Gliederung mit 4-6 Abschnitten f√ºr einen Artikel zum Thema.

                    Format:
                    ## [√úberschrift 1]
                    Kurze Beschreibung was in diesem Abschnitt stehen k√∂nnte.

                    ## [√úberschrift 2]
                    ...

                    Der Ton soll warmherzig und einladend sein.`,
                    `Thema: ${title}`
                );

                // Offer to insert
                showAIResult('aiContentResult', result, false);

                if (confirm('Gliederung in den Editor einf√ºgen?')) {
                    const editor = document.getElementById('postContent');
                    const html = result.split('\n').map(line => {
                        if (line.startsWith('## ')) {
                            return `<h2>${escapeHtml(line.substring(3))}</h2>`;
                        }
                        return `<p>${escapeHtml(line)}</p>`;
                    }).join('');
                    editor.innerHTML = html;
                    onContentChange();
                }
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnOutline', false);
            }
        }

        // ============================================
        // YOUTUBE TOPIC IDEAS
        // ============================================

        async function loadYouTubeIdeas() {
            setButtonLoading('btnYouTube', true);

            try {
                // Load video categories from JSON
                const response = await fetch('data/video-categories.json');
                const videos = await response.json();

                // Get latest 10 videos
                const videoList = Object.entries(videos)
                    .sort((a, b) => new Date(b[1].categorized_at) - new Date(a[1].categorized_at))
                    .slice(0, 10);

                aiState.youtubeVideos = videoList;

                // Generate blog ideas from video titles
                const videoTitles = videoList.map(([id, v]) => v.title).join('\n');

                const result = await groqAPI.call(
                    `Du bist ein Content-Stratege f√ºr eine Coaching-Website.
                    Basierend auf diesen YouTube-Video-Titeln, erstelle 3 Blog-Post-Ideen.

                    Jede Idee sollte:
                    - Einen ansprechenden Titel haben
                    - Eine kurze Beschreibung (1 Satz)
                    - Auf einem oder mehreren Videos basieren

                    Format als JSON Array:
                    [{"title": "...", "description": "...", "basedOn": "Video-Titel"}]`,
                    videoTitles,
                    'llama-3.1-70b-versatile'
                );

                // Parse and display
                try {
                    const ideas = JSON.parse(result);
                    const container = document.getElementById('youtubeIdeas');
                    container.innerHTML = ideas.map(idea => `
                        <div class="youtube-idea" onclick="useYouTubeIdea('${escapeHtml(idea.title)}')">
                            <div class="youtube-idea-title">
                                üìù ${escapeHtml(idea.title)}
                            </div>
                            <div class="youtube-idea-desc">
                                ${escapeHtml(idea.description)}<br>
                                <small style="color: #ff0000;">üé¨ Basiert auf: ${escapeHtml(idea.basedOn)}</small>
                            </div>
                        </div>
                    `).join('');
                } catch (e) {
                    // Fallback if JSON parsing fails
                    document.getElementById('youtubeIdeas').innerHTML = `
                        <div class="ai-result">${escapeHtml(result)}</div>
                    `;
                }

                toast('Themenvorschl√§ge geladen!', 'success');
            } catch (e) {
                toast('Fehler beim Laden: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnYouTube', false);
            }
        }

        function useYouTubeIdea(title) {
            document.getElementById('postTitle').value = title;
            onContentChange();
            toast('Titel √ºbernommen!', 'success');
        }

        // ============================================
        // SMART FORMATTING
        // ============================================

        function insertHighlightBox() {
            const html = `
                <div style="background: linear-gradient(135deg, #f5f0ff 0%, #fff5f5 100%);
                            border-left: 4px solid #667eea;
                            padding: 1.5rem;
                            border-radius: 8px;
                            margin: 1.5rem 0;">
                    <p style="font-weight: 600; color: #667eea; margin-bottom: 0.5rem;">üí° Wichtiger Gedanke</p>
                    <p>Hier deinen hervorgehobenen Gedanken einf√ºgen...</p>
                </div>
            `;
            execCmd('insertHTML', html);
            toast('Highlight-Box eingef√ºgt', 'success');
        }

        function insertCallout() {
            const html = `
                <div style="background: #fff8e1;
                            border: 1px solid #ffe082;
                            padding: 1.25rem;
                            border-radius: 8px;
                            margin: 1.5rem 0;
                            display: flex;
                            gap: 1rem;
                            align-items: flex-start;">
                    <span style="font-size: 1.5rem;">üìå</span>
                    <div>
                        <p style="font-weight: 600; margin-bottom: 0.25rem;">Merke dir</p>
                        <p style="margin: 0;">Hier eine wichtige Erkenntnis oder √úbung einf√ºgen...</p>
                    </div>
                </div>
            `;
            execCmd('insertHTML', html);
            toast('Callout eingef√ºgt', 'success');
        }

        function insertBlockquote() {
            const html = `
                <blockquote style="border-left: 4px solid #D4A574;
                                   padding: 1.5rem 2rem;
                                   margin: 2rem 0;
                                   background: #faf8f5;
                                   border-radius: 0 8px 8px 0;
                                   font-style: italic;
                                   font-size: 1.15rem;
                                   line-height: 1.7;">
                    <p>"Das Leben ist zu kurz f√ºr sp√§ter."</p>
                    <footer style="margin-top: 0.75rem; font-size: 0.9rem; font-style: normal; color: #666;">
                        ‚Äî Unbekannt
                    </footer>
                </blockquote>
            `;
            execCmd('insertHTML', html);
            toast('Zitat eingef√ºgt', 'success');
        }

        async function aiFormatForReadability() {
            const content = document.getElementById('postContent').innerHTML;

            if (content.length < 200) {
                toast('Bitte mehr Inhalt schreiben', 'warning');
                return;
            }

            setButtonLoading('btnReadability', true);

            try {
                const textContent = document.getElementById('postContent').innerText;

                const result = await groqAPI.call(
                    `Du bist ein Experte f√ºr Blog-Formatierung.
                    Formatiere den folgenden Text f√ºr bessere Lesbarkeit:

                    - Teile lange Abs√§tze in k√ºrzere (max 3-4 S√§tze)
                    - F√ºge Zwischen√ºberschriften (## ) ein wo sinnvoll
                    - Hebe wichtige S√§tze hervor mit **fett**
                    - F√ºge Listen ein wo passend
                    - Halte den Ton und Inhalt exakt bei

                    Gib den formatierten Text als HTML zur√ºck mit <h2>, <p>, <strong>, <ul>/<li> Tags.`,
                    textContent.substring(0, 4000)
                );

                // Preview
                if (confirm('Formatierung anwenden? (Vorschau im Konsolenfenster)')) {
                    document.getElementById('postContent').innerHTML = sanitizeHTML(result);
                    onContentChange();
                    toast('Formatierung angewendet!', 'success');
                }
            } catch (e) {
                toast('Fehler: ' + e.message, 'error');
            } finally {
                setButtonLoading('btnReadability', false);
            }
        }

        // ============================================
        // INIT
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            checkSetup();
            initAI();
        });
    </script>
</body>
</html>
